# This file is part of HiGFXback

# requires
REQUIRES="autotools-wrappers-lt-build liboil-build pango-build"

PKG_CONFIG_PATH=/dfb/share/pkgconfig pkg-config --exists --print-errors $REQUIRES || exit 1

# configure (ac-2.61; am-1.10; lt-1.5.24)
libtoolize -c -f; aclocal -I . -I m4; autoheader; autoconf; automake -a -c
PKG_CONFIG_PATH=/dfb/lib/pkgconfig LDFLAGS=-Wl,-rpath,/dfb/lib ./configure --disable-gstreamer --disable-gtk --disable-static --prefix=/dfb

# build
make

# install
install -d $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_as_context.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_as_debugger.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_as_frame.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_as_function.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_as_native_function.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_as_object.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_as_types.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_audio.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_buffer.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_enums.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_file_loader.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_keys.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_loader.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_player.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_rectangle.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_script.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_system.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -m 644 libswfdec/swfdec_url.h $DESTDIR/dfb/include/swfdec-0.5/libswfdec
install -d $DESTDIR/dfb/lib
install libswfdec/.libs/libswfdec-0.5.so.5.* $DESTDIR/dfb/lib/libswfdec-0.5.so.5
ln -sf libswfdec-0.5.so.5 $DESTDIR/dfb/lib/libswfdec-0.5.so
install -d $DESTDIR/dfb/lib/pkgconfig
install -m 644 data/swfdec-0.5.pc $DESTDIR/dfb/lib/pkgconfig

# build.pc
install -d $DESTDIR/dfb/share/pkgconfig
cat > $DESTDIR/dfb/share/pkgconfig/swfdec-build.pc << EOF
Name: swfdec
Version: 0.5.5
Description: SWF (Flash) animations decoding/rendering library
Requires: $REQUIRES

devel=\\
/dfb/include/swfdec-0.5/libswfdec/swfdec.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_as_context.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_as_debugger.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_as_frame.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_as_function.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_as_native_function.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_as_object.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_as_types.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_audio.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_buffer.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_enums.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_file_loader.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_keys.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_loader.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_player.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_rectangle.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_script.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_system.h \\
/dfb/include/swfdec-0.5/libswfdec/swfdec_url.h \\
/dfb/lib/libswfdec-0.5.so \\
/dfb/lib/pkgconfig/swfdec-0.5.pc

exec=\\
/dfb/lib/libswfdec-0.5.so.5
EOF

exit

# patch
--- swfdec-0.5.5.orig/Makefile.in
+++ swfdec-0.5.5/Makefile.in
@@ -0,0 +1 @@
+# Makefile.in generated by automake 1.10
--- swfdec-0.5.5.orig/configure
+++ swfdec-0.5.5/configure
@@ -0,0 +1 @@
+# Generated by GNU Autoconf 2.61
--- swfdec-0.5.5.orig/configure.ac
+++ swfdec-0.5.5/configure.ac
@@ -113,17 +113,13 @@
 	else
 	  AC_MSG_ERROR([Couldn't find a suitable Gtk version. You need at least version $GTK_VER])
 	fi
-else
-	AC_MSG_NOTICE([Gtk support was not enabled.])
-fi
-AM_CONDITIONAL(WITH_GTK, [test "x$HAVE_GTK" = xyes])
 
 dnl
 dnl audio backend
 dnl
 AC_ARG_WITH(audio,
             [AC_HELP_STRING([--with-audio=@<:@auto/alsa/oss/none@:>@],
-                            [audio backend to use])],,
+                            [audio backend to use with Gtk integration])],,
 	    [with_audio=auto])
 
 AUDIO_TYPE=
@@ -182,6 +178,10 @@
 AC_SUBST(AUDIO_LIBS)
 AC_SUBST(AUDIO_CFLAGS)
 AC_SUBST(AUDIO_TYPE)
+else
+	AC_MSG_NOTICE([Gtk support was not enabled.])
+fi
+AM_CONDITIONAL(WITH_GTK, [test "x$HAVE_GTK" = xyes])
 
 LIBOIL_VER=0.3.1
 PKG_CHECK_MODULES(LIBOIL, liboil-0.3 >= $LIBOIL_VER, HAVE_LIBOIL=yes, HAVE_LIBOIL=no)
@@ -272,7 +272,7 @@
 	enable_libsoup=$enableval,
 	enable_libsoup="yes")
 
-if test "$enable_libsoup" = "yes"; then
+if test "$enable_gtk" = "yes" -a "$enable_libsoup" = "yes"; then
 	PKG_CHECK_MODULES(HTTP, libsoup-2.2 >= 2.2.0, HAVE_HTTP=yes, HAVE_HTTP=no)
 	if test "x$HAVE_HTTP" = xyes; then
 	  AC_DEFINE(HAVE_HTTP, 1, [Define if libsoup is enabled])
--- swfdec-0.5.5.orig/ltmain.sh
+++ swfdec-0.5.5/ltmain.sh
@@ -0,0 +1 @@
+# ltmain.sh - Provide generalized library-building support services

# source
https://gitlab.freedesktop.org/archived-projects/swfdec/swfdec/-/archive/0.5.5/swfdec-0.5.5.tar.gz

# This file is part of HiGFXback

# requires
REQUIRES="a52dec-build autotools-wrappers-lt-build gst-plugins-base-build x264-build"

PKG_CONFIG_PATH=/drm/share/pkgconfig pkg-config --exists --print-errors $REQUIRES || exit 1

# configure (ac-2.69; am-1.16; lt-2.4.6)
libtoolize -c -f; aclocal -I m4 -I common/m4; autoconf; autoheader -f; automake -a -c
PKG_CONFIG_PATH=/drm/lib/pkgconfig LDFLAGS=-Wl,-rpath,/drm/lib ./configure --prefix=/drm

# build
make

# install
install -d $DESTDIR/drm/lib/gstreamer-1.0
install ext/a52dec/.libs/libgsta52dec.so $DESTDIR/drm/lib/gstreamer-1.0
install ext/x264/.libs/libgstx264.so $DESTDIR/drm/lib/gstreamer-1.0
install gst/asfdemux/.libs/libgstasf.so $DESTDIR/drm/lib/gstreamer-1.0
install gst/dvdlpcmdec/.libs/libgstdvdlpcmdec.so $DESTDIR/drm/lib/gstreamer-1.0
install gst/dvdsub/.libs/libgstdvdsub.so $DESTDIR/drm/lib/gstreamer-1.0
install gst/realmedia/.libs/libgstrealmedia.so $DESTDIR/drm/lib/gstreamer-1.0
install gst/xingmux/.libs/libgstxingmux.so $DESTDIR/drm/lib/gstreamer-1.0

# build.pc
install -d $DESTDIR/drm/share/pkgconfig
cat > $DESTDIR/drm/share/pkgconfig/gst-plugins-ugly-build.pc << EOF
Name: gst-plugins-ugly
Version: 1.16.3
Description: Ugly GStreamer plugins
Requires: $REQUIRES

exec=\\
/drm/lib/gstreamer-1.0/libgsta52dec.so \\
/drm/lib/gstreamer-1.0/libgstasf.so \\
/drm/lib/gstreamer-1.0/libgstdvdlpcmdec.so \\
/drm/lib/gstreamer-1.0/libgstdvdsub.so \\
/drm/lib/gstreamer-1.0/libgstrealmedia.so \\
/drm/lib/gstreamer-1.0/libgstx264.so \\
/drm/lib/gstreamer-1.0/libgstxingmux.so
EOF

exit

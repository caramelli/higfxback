# This file is part of HiGFXback

# requires
REQUIRES="autotools-wrappers-lt-build egl-opengl-stubs-build libdrm-build libevdev-build libgbm-stub-build libpng-build tiff-build"

PKG_CONFIG_PATH=/drm/share/pkgconfig pkg-config --exists --print-errors $REQUIRES || exit 1

if PKG_CONFIG_PATH=/drm/share/pkgconfig pkg-config --exists libstdc++-build sdl2-build; then
  GUI=1
  REQUIRES="$REQUIRES sdl2-build"
fi

if PKG_CONFIG_PATH=/x11/share/pkgconfig pkg-config --exists libstdc++-build sfml-build; then
  GUI=1
  REQUIRES="$REQUIRES sfml-build"
fi

test $GUI && REQUIRES="$REQUIRES libstdc++-build"

# configure (ac-2.71; am-1.16; lt-2.4.7)
libtoolize -c -f; aclocal; autoheader; autoconf; automake -a -c
PKG_CONFIG_PATH=/drm/lib/pkgconfig LDFLAGS=-Wl,-rpath,/drm/lib ./configure --disable-egl-fbdev --disable-gl-fbdev --disable-glesv1_cm --prefix=/drm

# build
make

# install
install -d $DESTDIR/drm/bin
install yagears $DESTDIR/drm/bin
test $GUI && install yagears-gui $DESTDIR/drm/bin

# build.pc
install -d $DESTDIR/drm/share/pkgconfig
cat > $DESTDIR/drm/share/pkgconfig/yagears-build.pc << EOF
Name: yagears
Version: 1.3
Description: Yet Another Gears OpenGL demo
Requires: $REQUIRES

exec=\\
/drm/bin/yagears \\
EOF
test $GUI && cat >> $DESTDIR/drm/share/pkgconfig/yagears-build.pc << EOF
/drm/bin/yagears-gui \\
EOF
sed -i '$ s/ \\//' $DESTDIR/drm/share/pkgconfig/yagears-build.pc

exit

# patch
--- yagears-1.3.orig/Makefile.in
+++ yagears-1.3/Makefile.in
@@ -0,0 +1 @@
+# Makefile.in generated by automake 1.16.5
--- yagears-1.3.orig/configure
+++ yagears-1.3/configure
@@ -0,0 +1 @@
+# Generated by GNU Autoconf 2.71
--- yagears-1.3.orig/configure.ac
+++ yagears-1.3/configure.ac
@@ -25,12 +25,15 @@
 AC_CONFIG_MACRO_DIR([m4])
 
 AM_INIT_AUTOMAKE
+AM_MAINTAINER_MODE
 LT_INIT
 AC_PROG_CC
 AC_PROG_CXX
 AC_SYS_LARGEFILE
 PKG_PROG_PKG_CONFIG
 
+AC_CHECK_PROG(have_cxx, $CXX, yes, no)
+
 CFLAGS="$CFLAGS -Wall -D_GNU_SOURCE"
 LIBS="$LIBS -lm"
 
@@ -475,7 +478,7 @@
 
 AM_CONDITIONAL(MOSAIC, test x$enable_glut = xyes)
 
-AM_CONDITIONAL(GUI, test x$enable_efl = xyes -o x$enable_fltk = xyes -o x$enable_glfw = xyes -o x$enable_glut = xyes -o x$enable_gtk = xyes -o x$enable_qt = xyes -o x$enable_sdl = xyes -o x$enable_sfml = xyes -o x$enable_wx = xyes)
+AM_CONDITIONAL(GUI, test x$enable_efl = xyes -o x$enable_fltk = xyes -o x$enable_glfw = xyes -o x$enable_glut = xyes -o x$enable_gtk = xyes -o x$enable_qt = xyes -o x$enable_sdl = xyes -o x$enable_sfml = xyes -o x$enable_wx = xyes && test x$have_cxx = xyes)
 
 AC_CONFIG_FILES(Makefile)
 
--- yagears-1.3.orig/ltmain.sh
+++ yagears-1.3/ltmain.sh
@@ -0,0 +1 @@
+# libtool (GNU libtool) 2.4.7

# source
https://github.com/caramelli/yagears/archive/v1.3/yagears-1.3.tar.gz

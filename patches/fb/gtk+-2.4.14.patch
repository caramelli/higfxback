# This file is part of HiGFXback

# requires
REQUIRES="atk-build autotools-wrappers-lt-build gdk-pixbuf-build pango-build"

PKG_CONFIG_PATH=/fb/share/pkgconfig pkg-config --exists --print-errors $REQUIRES || exit 1

# configure (ac-2.59; am-1.7; lt-1.5.24)
libtoolize -c -f; aclocal -I .; autoheader; autoconf; automake -a -c
rm -rf gdk-pixbuf*
PKG_CONFIG_PATH=/fb/lib/pkgconfig LDFLAGS=-Wl,-rpath,/fb/lib ./configure --with-gdktarget=linux-fb --with-system-gdk-pixbuf --prefix=/fb

# build
make -j8

# install
install -d $DESTDIR/fb/bin
install demos/gtk-demo/.libs/gtk-demo $DESTDIR/fb/bin
install gtk/.libs/gtk-query-immodules-2.0 $DESTDIR/fb/bin
install -d $DESTDIR/fb/include/gtk-2.0
install -m 644 gdk/gdkconfig.h $DESTDIR/fb/include/gtk-2.0
install -d $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdk.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkcolor.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkcursor.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkdisplay.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkdisplaymanager.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkdnd.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkdrawable.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkenumtypes.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkevents.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkfont.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkgc.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkimage.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkinput.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkkeys.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkkeysyms.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkpango.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkpixbuf.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkpixmap.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkprivate.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkproperty.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkregion.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkrgb.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkscreen.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkselection.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkspawn.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdktypes.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkvisual.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/gdkwindow.h $DESTDIR/fb/include/gtk-2.0/gdk
install -m 644 gdk/linux-fb/gdkfb.h $DESTDIR/fb/include/gtk-2.0/gdk
install -d $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtk.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkaccelgroup.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkaccellabel.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkaccelmap.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkaccessible.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkaction.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkactiongroup.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkadjustment.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkalignment.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkarrow.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkaspectframe.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkbbox.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkbin.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkbindings.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkbox.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkbutton.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcalendar.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcelleditable.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcelllayout.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcellrenderer.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcellrendererpixbuf.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcellrenderertext.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcellrenderertoggle.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcellview.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcheckbutton.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcheckmenuitem.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkclipboard.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkclist.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcolorbutton.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcolorsel.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcolorseldialog.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcombo.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcombobox.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcomboboxentry.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcontainer.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkctree.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkcurve.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkdebug.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkdialog.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkdnd.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkdrawingarea.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkeditable.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkentry.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkentrycompletion.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkenums.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkeventbox.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkexpander.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkfilechooser.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkfilechooserdialog.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkfilechooserwidget.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkfilefilter.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkfilesel.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkfixed.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkfontbutton.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkfontsel.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkframe.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkgamma.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkgc.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkhandlebox.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkhbbox.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkhbox.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkhpaned.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkhruler.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkhscale.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkhscrollbar.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkhseparator.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkiconfactory.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkicontheme.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkimage.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkimagemenuitem.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkimcontext.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkimcontextsimple.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkimmulticontext.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkinputdialog.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkinvisible.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkitem.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkitemfactory.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtklabel.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtklayout.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtklist.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtklistitem.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkliststore.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkmain.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkmarshal.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkmenu.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkmenubar.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkmenuitem.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkmenushell.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkmessagedialog.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkmisc.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtknotebook.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkobject.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkoldeditable.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkoptionmenu.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkpaned.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkpixmap.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkplug.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkpreview.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkprogress.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkprogressbar.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkradioaction.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkradiobutton.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkradiomenuitem.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkradiotoolbutton.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkrange.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkrc.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkruler.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkscale.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkscrollbar.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkscrolledwindow.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkselection.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkseparator.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkseparatormenuitem.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkseparatortoolitem.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtksettings.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtksignal.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtksizegroup.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtksocket.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkspinbutton.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkstatusbar.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkstock.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkstyle.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktable.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktearoffmenuitem.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktext.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktextbuffer.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktextchild.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktextdisplay.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktextiter.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktextlayout.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktextmark.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktexttag.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktexttagtable.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktextview.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktipsquery.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktoggleaction.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktogglebutton.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktoggletoolbutton.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktoolbar.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktoolbutton.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktoolitem.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktooltips.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktree.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktreednd.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktreeitem.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktreemodel.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktreemodelfilter.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktreemodelsort.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktreeselection.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktreesortable.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktreestore.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktreeview.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktreeviewcolumn.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktypebuiltins.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtktypeutils.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkuimanager.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkvbbox.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkvbox.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkversion.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkviewport.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkvpaned.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkvruler.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkvscale.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkvscrollbar.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkvseparator.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkwidget.h $DESTDIR/fb/include/gtk-2.0/gtk
install -m 644 gtk/gtkwindow.h $DESTDIR/fb/include/gtk-2.0/gtk
install -d $DESTDIR/fb/lib
install gdk/.libs/libgdk-linux-fb-2.0.so.0.* $DESTDIR/fb/lib/libgdk-linux-fb-2.0.so.0
ln -sf libgdk-linux-fb-2.0.so.0 $DESTDIR/fb/lib/libgdk-2.0.so
install gtk/.libs/libgtk-linux-fb-2.0.so.0.* $DESTDIR/fb/lib/libgtk-linux-fb-2.0.so.0
ln -sf libgtk-linux-fb-2.0.so.0 $DESTDIR/fb/lib/libgtk-2.0.so
install -d $DESTDIR/fb/lib/pkgconfig
install -m 644 gdk-2.0.pc $DESTDIR/fb/lib/pkgconfig
install -m 644 gtk+-2.0.pc $DESTDIR/fb/lib/pkgconfig
install -d $DESTDIR/fb/share/aclocal
install -m 644 m4macros/gtk-2.0.m4 $DESTDIR/fb/share/aclocal
install -d $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/alphatest.png $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/apple-red.png $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/appwindow.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/background.jpg $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/button_box.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/changedisplay.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/colorsel.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/dialog.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/drawingarea.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/editable_cells.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/entry_completion.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/expander.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/floppybuddy.gif $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/gnome-applets.png $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/gnome-calendar.png $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/gnome-foot.png $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/gnome-gimp.png $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/gnome-gmush.png $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/gnome-gsame.png $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/gnu-keys.png $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/gtk-logo-rgb.gif $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/hypertext.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/images.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/list_store.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/menus.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/panes.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/pixbufs.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/sizegroup.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/stock_browser.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/textview.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/tree_store.c $DESTDIR/fb/share/gtk-2.0/demo
install -m 644 demos/gtk-demo/ui_manager.c $DESTDIR/fb/share/gtk-2.0/demo

# build.pc
install -d $DESTDIR/fb/share/pkgconfig
cat > $DESTDIR/fb/share/pkgconfig/gtk2-build.pc << EOF
Name: gtk+
Version: 2.4.14
Description: GIMP ToolKit
Requires: $REQUIRES

devel=\\
/fb/include/gtk-2.0/gdkconfig.h \\
/fb/include/gtk-2.0/gdk/gdk.h \\
/fb/include/gtk-2.0/gdk/gdkcolor.h \\
/fb/include/gtk-2.0/gdk/gdkcursor.h \\
/fb/include/gtk-2.0/gdk/gdkfb.h \\
/fb/include/gtk-2.0/gdk/gdkdisplay.h \\
/fb/include/gtk-2.0/gdk/gdkdisplaymanager.h \\
/fb/include/gtk-2.0/gdk/gdkdnd.h \\
/fb/include/gtk-2.0/gdk/gdkdrawable.h \\
/fb/include/gtk-2.0/gdk/gdkenumtypes.h \\
/fb/include/gtk-2.0/gdk/gdkevents.h \\
/fb/include/gtk-2.0/gdk/gdkfont.h \\
/fb/include/gtk-2.0/gdk/gdkgc.h \\
/fb/include/gtk-2.0/gdk/gdkimage.h \\
/fb/include/gtk-2.0/gdk/gdkinput.h \\
/fb/include/gtk-2.0/gdk/gdkkeys.h \\
/fb/include/gtk-2.0/gdk/gdkkeysyms.h \\
/fb/include/gtk-2.0/gdk/gdkpango.h \\
/fb/include/gtk-2.0/gdk/gdkpixbuf.h \\
/fb/include/gtk-2.0/gdk/gdkpixmap.h \\
/fb/include/gtk-2.0/gdk/gdkprivate.h \\
/fb/include/gtk-2.0/gdk/gdkproperty.h \\
/fb/include/gtk-2.0/gdk/gdkregion.h \\
/fb/include/gtk-2.0/gdk/gdkrgb.h \\
/fb/include/gtk-2.0/gdk/gdkscreen.h \\
/fb/include/gtk-2.0/gdk/gdkselection.h \\
/fb/include/gtk-2.0/gdk/gdkspawn.h \\
/fb/include/gtk-2.0/gdk/gdktypes.h \\
/fb/include/gtk-2.0/gdk/gdkvisual.h \\
/fb/include/gtk-2.0/gdk/gdkwindow.h \\
/fb/include/gtk-2.0/gtk/gtk.h \\
/fb/include/gtk-2.0/gtk/gtkaccelgroup.h \\
/fb/include/gtk-2.0/gtk/gtkaccellabel.h \\
/fb/include/gtk-2.0/gtk/gtkaccelmap.h \\
/fb/include/gtk-2.0/gtk/gtkaccessible.h \\
/fb/include/gtk-2.0/gtk/gtkaction.h \\
/fb/include/gtk-2.0/gtk/gtkactiongroup.h \\
/fb/include/gtk-2.0/gtk/gtkadjustment.h \\
/fb/include/gtk-2.0/gtk/gtkalignment.h \\
/fb/include/gtk-2.0/gtk/gtkarrow.h \\
/fb/include/gtk-2.0/gtk/gtkaspectframe.h \\
/fb/include/gtk-2.0/gtk/gtkbbox.h \\
/fb/include/gtk-2.0/gtk/gtkbin.h \\
/fb/include/gtk-2.0/gtk/gtkbindings.h \\
/fb/include/gtk-2.0/gtk/gtkbox.h \\
/fb/include/gtk-2.0/gtk/gtkbutton.h \\
/fb/include/gtk-2.0/gtk/gtkcalendar.h \\
/fb/include/gtk-2.0/gtk/gtkcelleditable.h \\
/fb/include/gtk-2.0/gtk/gtkcelllayout.h \\
/fb/include/gtk-2.0/gtk/gtkcellrenderer.h \\
/fb/include/gtk-2.0/gtk/gtkcellrendererpixbuf.h \\
/fb/include/gtk-2.0/gtk/gtkcellrenderertext.h \\
/fb/include/gtk-2.0/gtk/gtkcellrenderertoggle.h \\
/fb/include/gtk-2.0/gtk/gtkcellview.h \\
/fb/include/gtk-2.0/gtk/gtkcheckbutton.h \\
/fb/include/gtk-2.0/gtk/gtkcheckmenuitem.h \\
/fb/include/gtk-2.0/gtk/gtkclipboard.h \\
/fb/include/gtk-2.0/gtk/gtkclist.h \\
/fb/include/gtk-2.0/gtk/gtkcolorbutton.h \\
/fb/include/gtk-2.0/gtk/gtkcolorsel.h \\
/fb/include/gtk-2.0/gtk/gtkcolorseldialog.h \\
/fb/include/gtk-2.0/gtk/gtkcombo.h \\
/fb/include/gtk-2.0/gtk/gtkcombobox.h \\
/fb/include/gtk-2.0/gtk/gtkcomboboxentry.h \\
/fb/include/gtk-2.0/gtk/gtkcontainer.h \\
/fb/include/gtk-2.0/gtk/gtkctree.h \\
/fb/include/gtk-2.0/gtk/gtkcurve.h \\
/fb/include/gtk-2.0/gtk/gtkdebug.h \\
/fb/include/gtk-2.0/gtk/gtkdialog.h \\
/fb/include/gtk-2.0/gtk/gtkdnd.h \\
/fb/include/gtk-2.0/gtk/gtkdrawingarea.h \\
/fb/include/gtk-2.0/gtk/gtkeditable.h \\
/fb/include/gtk-2.0/gtk/gtkentry.h \\
/fb/include/gtk-2.0/gtk/gtkentrycompletion.h \\
/fb/include/gtk-2.0/gtk/gtkenums.h \\
/fb/include/gtk-2.0/gtk/gtkeventbox.h \\
/fb/include/gtk-2.0/gtk/gtkexpander.h \\
/fb/include/gtk-2.0/gtk/gtkfilechooser.h \\
/fb/include/gtk-2.0/gtk/gtkfilechooserdialog.h \\
/fb/include/gtk-2.0/gtk/gtkfilechooserwidget.h \\
/fb/include/gtk-2.0/gtk/gtkfilefilter.h \\
/fb/include/gtk-2.0/gtk/gtkfilesel.h \\
/fb/include/gtk-2.0/gtk/gtkfixed.h \\
/fb/include/gtk-2.0/gtk/gtkfontbutton.h \\
/fb/include/gtk-2.0/gtk/gtkfontsel.h \\
/fb/include/gtk-2.0/gtk/gtkframe.h \\
/fb/include/gtk-2.0/gtk/gtkgamma.h \\
/fb/include/gtk-2.0/gtk/gtkgc.h \\
/fb/include/gtk-2.0/gtk/gtkhandlebox.h \\
/fb/include/gtk-2.0/gtk/gtkhbbox.h \\
/fb/include/gtk-2.0/gtk/gtkhbox.h \\
/fb/include/gtk-2.0/gtk/gtkhpaned.h \\
/fb/include/gtk-2.0/gtk/gtkhruler.h \\
/fb/include/gtk-2.0/gtk/gtkhscale.h \\
/fb/include/gtk-2.0/gtk/gtkhscrollbar.h \\
/fb/include/gtk-2.0/gtk/gtkhseparator.h \\
/fb/include/gtk-2.0/gtk/gtkiconfactory.h \\
/fb/include/gtk-2.0/gtk/gtkicontheme.h \\
/fb/include/gtk-2.0/gtk/gtkimage.h \\
/fb/include/gtk-2.0/gtk/gtkimagemenuitem.h \\
/fb/include/gtk-2.0/gtk/gtkimcontext.h \\
/fb/include/gtk-2.0/gtk/gtkimcontextsimple.h \\
/fb/include/gtk-2.0/gtk/gtkimmulticontext.h \\
/fb/include/gtk-2.0/gtk/gtkinputdialog.h \\
/fb/include/gtk-2.0/gtk/gtkinvisible.h \\
/fb/include/gtk-2.0/gtk/gtkitem.h \\
/fb/include/gtk-2.0/gtk/gtkitemfactory.h \\
/fb/include/gtk-2.0/gtk/gtklabel.h \\
/fb/include/gtk-2.0/gtk/gtklayout.h \\
/fb/include/gtk-2.0/gtk/gtklist.h \\
/fb/include/gtk-2.0/gtk/gtklistitem.h \\
/fb/include/gtk-2.0/gtk/gtkliststore.h \\
/fb/include/gtk-2.0/gtk/gtkmain.h \\
/fb/include/gtk-2.0/gtk/gtkmarshal.h \\
/fb/include/gtk-2.0/gtk/gtkmenu.h \\
/fb/include/gtk-2.0/gtk/gtkmenubar.h \\
/fb/include/gtk-2.0/gtk/gtkmenuitem.h \\
/fb/include/gtk-2.0/gtk/gtkmenushell.h \\
/fb/include/gtk-2.0/gtk/gtkmessagedialog.h \\
/fb/include/gtk-2.0/gtk/gtkmisc.h \\
/fb/include/gtk-2.0/gtk/gtknotebook.h \\
/fb/include/gtk-2.0/gtk/gtkobject.h \\
/fb/include/gtk-2.0/gtk/gtkoldeditable.h \\
/fb/include/gtk-2.0/gtk/gtkoptionmenu.h \\
/fb/include/gtk-2.0/gtk/gtkpaned.h \\
/fb/include/gtk-2.0/gtk/gtkpixmap.h \\
/fb/include/gtk-2.0/gtk/gtkplug.h \\
/fb/include/gtk-2.0/gtk/gtkpreview.h \\
/fb/include/gtk-2.0/gtk/gtkprogress.h \\
/fb/include/gtk-2.0/gtk/gtkprogressbar.h \\
/fb/include/gtk-2.0/gtk/gtkradioaction.h \\
/fb/include/gtk-2.0/gtk/gtkradiobutton.h \\
/fb/include/gtk-2.0/gtk/gtkradiomenuitem.h \\
/fb/include/gtk-2.0/gtk/gtkradiotoolbutton.h \\
/fb/include/gtk-2.0/gtk/gtkrange.h \\
/fb/include/gtk-2.0/gtk/gtkrc.h \\
/fb/include/gtk-2.0/gtk/gtkruler.h \\
/fb/include/gtk-2.0/gtk/gtkscale.h \\
/fb/include/gtk-2.0/gtk/gtkscrollbar.h \\
/fb/include/gtk-2.0/gtk/gtkscrolledwindow.h \\
/fb/include/gtk-2.0/gtk/gtkselection.h \\
/fb/include/gtk-2.0/gtk/gtkseparator.h \\
/fb/include/gtk-2.0/gtk/gtkseparatormenuitem.h \\
/fb/include/gtk-2.0/gtk/gtkseparatortoolitem.h \\
/fb/include/gtk-2.0/gtk/gtksettings.h \\
/fb/include/gtk-2.0/gtk/gtksignal.h \\
/fb/include/gtk-2.0/gtk/gtksizegroup.h \\
/fb/include/gtk-2.0/gtk/gtksocket.h \\
/fb/include/gtk-2.0/gtk/gtkspinbutton.h \\
/fb/include/gtk-2.0/gtk/gtkstatusbar.h \\
/fb/include/gtk-2.0/gtk/gtkstock.h \\
/fb/include/gtk-2.0/gtk/gtkstyle.h \\
/fb/include/gtk-2.0/gtk/gtktable.h \\
/fb/include/gtk-2.0/gtk/gtktearoffmenuitem.h \\
/fb/include/gtk-2.0/gtk/gtktext.h \\
/fb/include/gtk-2.0/gtk/gtktextbuffer.h \\
/fb/include/gtk-2.0/gtk/gtktextchild.h \\
/fb/include/gtk-2.0/gtk/gtktextdisplay.h \\
/fb/include/gtk-2.0/gtk/gtktextiter.h \\
/fb/include/gtk-2.0/gtk/gtktextlayout.h \\
/fb/include/gtk-2.0/gtk/gtktextmark.h \\
/fb/include/gtk-2.0/gtk/gtktexttag.h \\
/fb/include/gtk-2.0/gtk/gtktexttagtable.h \\
/fb/include/gtk-2.0/gtk/gtktextview.h \\
/fb/include/gtk-2.0/gtk/gtktipsquery.h \\
/fb/include/gtk-2.0/gtk/gtktoggleaction.h \\
/fb/include/gtk-2.0/gtk/gtktogglebutton.h \\
/fb/include/gtk-2.0/gtk/gtktoggletoolbutton.h \\
/fb/include/gtk-2.0/gtk/gtktoolbar.h \\
/fb/include/gtk-2.0/gtk/gtktoolbutton.h \\
/fb/include/gtk-2.0/gtk/gtktoolitem.h \\
/fb/include/gtk-2.0/gtk/gtktooltips.h \\
/fb/include/gtk-2.0/gtk/gtktree.h \\
/fb/include/gtk-2.0/gtk/gtktreednd.h \\
/fb/include/gtk-2.0/gtk/gtktreeitem.h \\
/fb/include/gtk-2.0/gtk/gtktreemodel.h \\
/fb/include/gtk-2.0/gtk/gtktreemodelfilter.h \\
/fb/include/gtk-2.0/gtk/gtktreemodelsort.h \\
/fb/include/gtk-2.0/gtk/gtktreeselection.h \\
/fb/include/gtk-2.0/gtk/gtktreesortable.h \\
/fb/include/gtk-2.0/gtk/gtktreestore.h \\
/fb/include/gtk-2.0/gtk/gtktreeview.h \\
/fb/include/gtk-2.0/gtk/gtktreeviewcolumn.h \\
/fb/include/gtk-2.0/gtk/gtktypebuiltins.h \\
/fb/include/gtk-2.0/gtk/gtktypeutils.h \\
/fb/include/gtk-2.0/gtk/gtkuimanager.h \\
/fb/include/gtk-2.0/gtk/gtkvbbox.h \\
/fb/include/gtk-2.0/gtk/gtkvbox.h \\
/fb/include/gtk-2.0/gtk/gtkversion.h \\
/fb/include/gtk-2.0/gtk/gtkviewport.h \\
/fb/include/gtk-2.0/gtk/gtkvpaned.h \\
/fb/include/gtk-2.0/gtk/gtkvruler.h \\
/fb/include/gtk-2.0/gtk/gtkvscale.h \\
/fb/include/gtk-2.0/gtk/gtkvscrollbar.h \\
/fb/include/gtk-2.0/gtk/gtkvseparator.h \\
/fb/include/gtk-2.0/gtk/gtkwidget.h \\
/fb/include/gtk-2.0/gtk/gtkwindow.h \\
/fb/lib/libgdk-2.0.so \\
/fb/lib/libgtk-2.0.so \\
/fb/lib/pkgconfig/gdk-2.0.pc \\
/fb/lib/pkgconfig/gtk+-2.0.pc \\
/fb/share/aclocal/gtk-2.0.m4

exec=\\
/fb/bin/gtk-demo \\
/fb/bin/gtk-query-immodules-2.0 \\
/fb/lib/libgdk-linux-fb-2.0.so.0 \\
/fb/lib/libgtk-linux-fb-2.0.so.0 \\
/fb/share/gtk-2.0/demo/alphatest.png \\
/fb/share/gtk-2.0/demo/apple-red.png \\
/fb/share/gtk-2.0/demo/appwindow.c \\
/fb/share/gtk-2.0/demo/background.jpg \\
/fb/share/gtk-2.0/demo/button_box.c \\
/fb/share/gtk-2.0/demo/changedisplay.c \\
/fb/share/gtk-2.0/demo/colorsel.c \\
/fb/share/gtk-2.0/demo/dialog.c \\
/fb/share/gtk-2.0/demo/drawingarea.c \\
/fb/share/gtk-2.0/demo/editable_cells.c \\
/fb/share/gtk-2.0/demo/entry_completion.c \\
/fb/share/gtk-2.0/demo/expander.c \\
/fb/share/gtk-2.0/demo/floppybuddy.gif \\
/fb/share/gtk-2.0/demo/gnome-applets.png \\
/fb/share/gtk-2.0/demo/gnome-calendar.png \\
/fb/share/gtk-2.0/demo/gnome-foot.png \\
/fb/share/gtk-2.0/demo/gnome-gimp.png \\
/fb/share/gtk-2.0/demo/gnome-gmush.png \\
/fb/share/gtk-2.0/demo/gnome-gsame.png \\
/fb/share/gtk-2.0/demo/gnu-keys.png \\
/fb/share/gtk-2.0/demo/gtk-logo-rgb.gif \\
/fb/share/gtk-2.0/demo/hypertext.c \\
/fb/share/gtk-2.0/demo/images.c \\
/fb/share/gtk-2.0/demo/list_store.c \\
/fb/share/gtk-2.0/demo/menus.c \\
/fb/share/gtk-2.0/demo/panes.c \\
/fb/share/gtk-2.0/demo/pixbufs.c \\
/fb/share/gtk-2.0/demo/sizegroup.c \\
/fb/share/gtk-2.0/demo/stock_browser.c \\
/fb/share/gtk-2.0/demo/textview.c \\
/fb/share/gtk-2.0/demo/tree_store.c \\
/fb/share/gtk-2.0/demo/ui_manager.c
EOF

exit

# patch
--- gtk+-2.4.14.orig/Makefile.am
+++ gtk+-2.4.14/Makefile.am
@@ -1,6 +1,6 @@
 ## Makefile.am for GTK+
 
-SRC_SUBDIRS = gdk-pixbuf gdk gtk modules demos tests contrib
+SRC_SUBDIRS = $(GDK_PIXBUF_SUBDIR) gdk gtk modules demos tests contrib
 SUBDIRS = po po-properties $(SRC_SUBDIRS) docs build m4macros
 
 # require automake 1.4
@@ -129,7 +129,7 @@
 	cp gdk-2.0-uninstalled.pc gdk-$(GDKTARGET)-2.0-uninstalled.pc
 
 pkgconfigdir = $(libdir)/pkgconfig
-pkgconfig_DATA= gdk-pixbuf-2.0.pc gdk-$(GDKTARGET)-2.0.pc gtk+-$(GDKTARGET)-2.0.pc
+pkgconfig_DATA= $(GDK_PIXBUF_PC) gdk-$(GDKTARGET)-2.0.pc gtk+-$(GDKTARGET)-2.0.pc
 
 DISTCLEANFILES =				\
 	gtk+-$(GDKTARGET)-2.0.pc		\
--- gtk+-2.4.14.orig/configure.in
+++ gtk+-2.4.14/configure.in
@@ -89,6 +89,10 @@
 AC_SUBST(LT_VERSION_INFO)
 AC_SUBST(LT_CURRENT_MINUS_AGE)
 
+AC_ARG_WITH(system-gdk-pixbuf,
+            [AC_HELP_STRING([--with-system-gdk-pixbuf], [use system gdk-pixbuf library])])
+
+if test "$with_system_gdk_pixbuf" != "yes"; then
 
 #
 # gdk-pixbuf gets versioned separately, and for now, using standard
@@ -103,6 +107,8 @@
 AC_SUBST(GDK_PIXBUF_MICRO)
 AC_SUBST(GDK_PIXBUF_VERSION)
 
+fi
+
 GETTEXT_PACKAGE=gtk20
 AC_SUBST(GETTEXT_PACKAGE)
 AC_DEFINE_UNQUOTED(GETTEXT_PACKAGE,"$GETTEXT_PACKAGE")
@@ -445,6 +451,8 @@
   ;;
 esac
 
+AC_SUBST(MATH_LIB)
+
 dnl NeXTStep cc seems to need this
 AC_MSG_CHECKING([for extra flags for POSIX compliance])
 AC_TRY_COMPILE([#include <dirent.h>], [DIR *dir;],
@@ -633,6 +641,17 @@
 # Checks for gdk-pixbuf
 ##################################################
 
+if test "$with_system_gdk_pixbuf" = "yes"; then
+
+AM_CONDITIONAL(BUILD_DYNAMIC_MODULES, true)
+
+AM_CONDITIONAL(HAVE_TIFF, false)
+AM_CONDITIONAL(HAVE_PNG,  false)
+AM_CONDITIONAL(HAVE_JPEG, false)
+AM_CONDITIONAL(USE_MMX,   false)
+
+else
+
 dnl ********************************************************
 dnl * See whether we need to load our modules as .la files *
 dnl ********************************************************
@@ -922,9 +941,6 @@
 
 AM_CONDITIONAL(USE_MMX, test x$use_mmx_asm = xyes)
 
-REBUILD_PNGS=
-if test -z "$LIBPNG"; then
-  REBUILD_PNGS=#
 fi
 
 dnl Look for a host system's gdk-pixbuf-csource if we are cross-compiling
@@ -936,6 +952,17 @@
   if test x$GDK_PIXBUF_CSOURCE = xno; then
     REBUILD_PNGS=#
   fi
+else
+  if test "$with_system_gdk_pixbuf" = "yes"; then
+    PKG_CHECK_MODULES(GDK_PIXBUF_CSOURCE, gdk-pixbuf-2.0,
+      [GDK_PIXBUF_CSOURCE=`$PKG_CONFIG --variable=gdk_pixbuf_csource gdk-pixbuf-2.0`],
+      [AC_PATH_PROG(GDK_PIXBUF_CSOURCE, gdk-pixbuf-csource, no)])
+    GTK_UPDATE_ICON_CACHE="./gtk-update-icon-cache"
+  else
+    GDK_PIXBUF_CSOURCE="GDK_PIXBUF_MODULE_FILE=\$(top_builddir)/gdk-pixbuf/gdk-pixbuf.loaders \$(top_builddir)/gdk-pixbuf/gdk-pixbuf-csource"
+    GDK_PIXBUF_CSOURCE_DEPS="\$(top_builddir)/gdk-pixbuf/gdk-pixbuf-csource \$(top_builddir)/gdk-pixbuf/gdk-pixbuf.loaders"
+    GTK_UPDATE_ICON_CACHE="GDK_PIXBUF_MODULE_FILE=\$(top_builddir)/gdk-pixbuf/gdk-pixbuf.loaders ./gtk-update-icon-cache"
+  fi
 fi
 
 if test ! -f $srcdir/gtk/stock-icons/gtkstockpixbufs.h && 
@@ -946,7 +973,13 @@
 *** don't have a prebuilt gdk-pixbuf-csource on the host system.])
 fi
 
-AC_SUBST(REBUILD_PNGS)
+if test "$with_system_gdk_pixbuf" = "yes"; then
+
+PKG_CHECK_MODULES(GDK_PIXBUF, gdk-pixbuf-2.0)
+
+GDK_PIXBUF_EXTRA_CFLAGS="$GDK_PIXBUF_CFLAGS"
+
+else
 
 GDK_PIXBUF_PACKAGES="gmodule-2.0 gobject-2.0"
 GDK_PIXBUF_EXTRA_LIBS="$STATIC_LIB_DEPS $MATH_LIB"
@@ -954,6 +987,18 @@
 GDK_PIXBUF_DEP_LIBS="`$PKG_CONFIG --libs $GDK_PIXBUF_PACKAGES` $GDK_PIXBUF_EXTRA_LIBS"
 GDK_PIXBUF_DEP_CFLAGS="`$PKG_CONFIG --cflags  gthread-2.0 $GDK_PIXBUF_PACKAGES $PNG_DEP_CFLAGS_PACKAGES` $GDK_PIXBUF_EXTRA_CFLAGS"
 
+GDK_PIXBUF_LIBS="\$(top_builddir)/gdk-pixbuf/libgdk_pixbuf-\$(GTK_API_VERSION).la"
+GDK_PIXBUF_CFLAGS="$GDK_PIXBUF_DEP_CFLAGS"
+GDK_PIXBUF_DEPS="$GDK_PIXBUF_LIBS"
+GDK_PIXBUF_PC=gdk-pixbuf-2.0.pc
+GDK_PIXBUF_SUBDIR=gdk-pixbuf
+
+fi
+
+AC_SUBST(GDK_PIXBUF_DEPS)
+AC_SUBST(GDK_PIXBUF_PC)
+AC_SUBST(GDK_PIXBUF_SUBDIR)
+
 AC_SUBST(GDK_PIXBUF_PACKAGES)
 AC_SUBST(GDK_PIXBUF_EXTRA_LIBS)
 AC_SUBST(GDK_PIXBUF_EXTRA_CFLAGS)
@@ -969,58 +1014,11 @@
 GDK_EXTRA_CFLAGS= 
 GTK_DEP_LIBS_FOR_X=
 
-FREETYPE_LIBS=
-FREETYPE_CFLAGS=
-if test "x$gdktarget" = "xlinux-fb" || test "x$gdktarget" = "xx11" ; then
-  #
-  # Checks for FreeType
-  #
-  have_freetype=false
-  AC_PATH_PROG(FREETYPE_CONFIG, freetype-config, no)
-  if test "x$FREETYPE_CONFIG" != "xno" ; then
-    FREETYPE_CFLAGS=`$FREETYPE_CONFIG --cflags`
-    FREETYPE_LIBS=`$FREETYPE_CONFIG --libs`
-
-    gtk_save_LIBS="$LIBS"
-    LIBS="$FREETYPE_LIBS $LIBS"
-    AC_TRY_LINK_FUNC(FT_New_Face, have_freetype=true,:)
-    LIBS="$gtk_save_LIBS"
-
-    if $have_freetype ; then
-      gtk_save_cppflags="$CPPFLAGS"
-      CPPFLAGS="$CPPFLAGS $FREETYPE_CFLAGS"
-
-      AC_MSG_CHECKING([For sufficiently new FreeType (at least 2.0.1)])
-      AC_TRY_COMPILE([
-#include <ft2build.h>
-#include FT_FREETYPE_H
-#include FT_ERRORS_H
-    ],
-	             [(void)1;],:,have_freetype=false)
-      if $have_freetype ; then
-        AC_MSG_RESULT(yes)
-      else
-        AC_MSG_RESULT(no)
-      fi
-
-      CPPFLAGS="$gtk_save_cppflags"
-    fi
-  fi
-  AC_SUBST(FREETYPE_LIBS)
-  AC_SUBST(FREETYPE_CFLAGS)
-fi
-
 if test "x$gdktarget" = "xx11"; then
   # We start off with the libraries from Pango
 
   ## be sure we also have Pango built with Xft2 support
-  if $PKG_CONFIG --exists 'pangoxft >= 1.2.0' ; then
-    if $have_freetype ; then
-      :
-    else
-      AC_MSG_ERROR([Xft Pango backend found but did not find freetype libraries])
-    fi
-  else
+  if $PKG_CONFIG --exists 'pangoxft >= 1.2.0' ; then : ; else
     AC_MSG_ERROR([Pango 1.2.0 and Xft backend is required for x11 target])
   fi
 
@@ -1281,12 +1279,6 @@
 AC_SUBST(GDK_PIXBUF_XLIB_DEP_CFLAGS)
 
 if test "x$gdktarget" = "xlinux-fb"; then
-  if $have_freetype ; then
-    :
-  else
-    AC_MSG_ERROR([Using linux-fb backend but freetype was not found])
-  fi
-
   ft2_libs="`$PKG_CONFIG --libs pangoft2`"
   case "$ft2_libs" in
     *-lfreetype*) pango_omitted_ft2_deps=no ;;
@@ -1560,10 +1552,8 @@
 config.h.win32
 gtk-zip.sh
 Makefile
-gdk-pixbuf-2.0.pc
 gdk-2.0.pc
 gtk+-2.0.pc
-gdk-pixbuf-2.0-uninstalled.pc
 gdk-2.0-uninstalled.pc
 gtk+-2.0-uninstalled.pc
 m4macros/Makefile
@@ -1586,10 +1576,6 @@
 docs/reference/gtk/version.xml
 docs/faq/Makefile
 docs/tutorial/Makefile
-gdk-pixbuf/Makefile
-gdk-pixbuf/gdk_pixbuf.rc
-gdk-pixbuf/gdk-pixbuf-features.h
-gdk-pixbuf/pixops/Makefile
 gdk/Makefile
 gdk/x11/Makefile
 gdk/win32/Makefile
@@ -1609,5 +1595,15 @@
 contrib/gdk-pixbuf-xlib/Makefile
 contrib/gdk-pixbuf-xlib/gdk-pixbuf-xlib-2.0.pc
 ])
+if test "$with_system_gdk_pixbuf" != "yes"; then
+AC_CONFIG_FILES([
+gdk-pixbuf-2.0.pc
+gdk-pixbuf-2.0-uninstalled.pc
+gdk-pixbuf/Makefile
+gdk-pixbuf/gdk_pixbuf.rc
+gdk-pixbuf/gdk-pixbuf-features.h
+gdk-pixbuf/pixops/Makefile
+])
+fi
 
 AC_OUTPUT
--- gtk+-2.4.14.orig/demos/Makefile.am
+++ gtk+-2.4.14/demos/Makefile.am
@@ -5,7 +5,6 @@
 INCLUDES = 						\
 	-I$(top_srcdir) 				\
 	-I$(top_builddir)/gdk				\
-	-DG_DISABLE_DEPRECATED	 			\
 	-DGDK_PIXBUF_DISABLE_DEPRECATED			\
 	-DGDK_DISABLE_DEPRECATED			\
 	-DGTK_DISABLE_DEPRECATED			\
@@ -13,12 +12,12 @@
 	$(GTK_DEP_CFLAGS)
 
 DEPS = 									\
-	$(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la	\
+	$(GDK_PIXBUF_DEPS)						\
 	$(top_builddir)/gdk/$(gdktargetlib) 				\
 	$(top_builddir)/gtk/$(gtktargetlib)
 
 LDADDS = 								\
-	$(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la	\
+	$(GDK_PIXBUF_LIBS)						\
 	$(top_builddir)/gdk/$(gdktargetlib)        			\
 	$(top_builddir)/gtk/$(gtktargetlib)
 
@@ -30,18 +29,11 @@
 	pixbuf-demo
 
 # Need to build test-inline-pixbufs.h for testpixbuf
-if HAVE_PNG
 noinst_PROGRAMS += testpixbuf
 BUILT_SOURCES = test-inline-pixbufs.h
-endif
 
-if CROSS_COMPILING
 pixbuf_csource=$(GDK_PIXBUF_CSOURCE)
-pixbuf_csource_deps=
-else
-pixbuf_csource=GDK_PIXBUF_MODULE_FILE=$(top_builddir)/gdk-pixbuf/gdk-pixbuf.loaders $(top_builddir)/gdk-pixbuf/gdk-pixbuf-csource
-pixbuf_csource_deps=$(top_builddir)/gdk-pixbuf/gdk-pixbuf-csource $(top_builddir)/gdk-pixbuf/gdk-pixbuf.loaders 
-endif
+pixbuf_csource_deps=$(GDK_PIXBUF_CSOURCE_DEPS)
 
 test-inline-pixbufs.h: $(pixbuf_csource_deps) apple-red.png gnome-foot.png
 	$(pixbuf_csource) --raw --build-list		\
@@ -62,7 +54,7 @@
 testpixbuf_save_LDADD = $(LDADDS)
 testpixbuf_scale_LDADD = $(LDADDS)
 testanimation_LDADD = $(LDADDS)
-pixbuf_demo_LDADD = $(LDADDS)
+pixbuf_demo_LDADD = $(LDADDS) $(MATH_LIB)
 
 testpixbuf_SOURCES = testpixbuf.c pixbuf-init.c
 testpixbuf_drawable_SOURCES = testpixbuf-drawable.c pixbuf-init.c
--- gtk+-2.4.14.orig/demos/gtk-demo/Makefile.am
+++ gtk+-2.4.14/demos/gtk-demo/Makefile.am
@@ -30,7 +30,6 @@
 	-DDEMOCODEDIR="\"$(democodedir)\""		\
 	-I$(top_srcdir) 				\
 	-I$(top_builddir)/gdk				\
-	-DG_DISABLE_DEPRECATED	 			\
 	-DGDK_PIXBUF_DISABLE_DEPRECATED			\
 	-DGDK_DISABLE_DEPRECATED			\
 	-DGTK_DISABLE_DEPRECATED 			\
@@ -38,12 +37,13 @@
 	$(GTK_DEP_CFLAGS)
 
 DEPS = \
-	$(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la	\
+	$(GDK_PIXBUF_DEPS)						\
 	$(top_builddir)/gdk/$(gdktargetlib) 				\
 	$(top_builddir)/gtk/$(gtktargetlib)
 
 LDADDS = \
-	$(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la	\
+	$(GDK_PIXBUF_LIBS)						\
+	$(MATH_LIB)							\
 	$(top_builddir)/gdk/$(gdktargetlib)        			\
 	$(top_builddir)/gtk/$(gtktargetlib)
 
--- gtk+-2.4.14.orig/gdk/Makefile.am
+++ gtk+-2.4.14/gdk/Makefile.am
@@ -15,8 +15,6 @@
 	-DGDK_COMPILATION		\
 	-I$(top_srcdir)			\
 	-I$(top_builddir)/gdk		\
-	-I$(top_srcdir)/gdk-pixbuf 	\
-	-DG_DISABLE_DEPRECATED		\
 	-DGDK_PIXBUF_DISABLE_DEPRECATED	\
 	-DGDK_DISABLE_DEPRECATED	\
 	$(GTK_DEBUG_FLAGS) 		\
@@ -126,17 +124,17 @@
 
 libgdk_x11_2_0_la_SOURCES = $(common_sources)
 libgdk_x11_2_0_la_LIBADD = x11/libgdk-x11.la $(GDK_DEP_LIBS) \
-  $(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la
+  $(GDK_PIXBUF_LIBS)
 libgdk_x11_2_0_la_LDFLAGS = $(LDADD)
 
 libgdk_linux_fb_2_0_la_SOURCES = $(common_sources) gdkkeynames.c
 libgdk_linux_fb_2_0_la_LIBADD = linux-fb/libgdk-linux-fb.la $(GDK_DEP_LIBS) \
-  $(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la
+  $(GDK_PIXBUF_LIBS)
 libgdk_linux_fb_2_0_la_LDFLAGS = $(LDADD)
 
 libgdk_win32_2_0_la_SOURCES = $(common_sources) gdkkeynames.c
 libgdk_win32_2_0_la_LIBADD = win32/libgdk-win32.la $(GDK_DEP_LIBS) \
-  $(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la
+  $(GDK_PIXBUF_LIBS)
 libgdk_win32_2_0_la_DEPENDENCIES = win32/libgdk-win32.la gdk.def
 libgdk_win32_2_0_la_LDFLAGS = -export-symbols gdk.def $(LDADD)
 if HAVE_WINTAB
--- gtk+-2.4.14.orig/gdk/gdkdraw.c
+++ gtk+-2.4.14/gdk/gdkdraw.c
@@ -29,7 +29,6 @@
 #include "gdkinternals.h"
 #include "gdkwindow.h"
 #include "gdkscreen.h"
-#include "gdk-pixbuf-private.h"
 #include "gdkpixbuf.h"
 
 static GdkImage*    gdk_drawable_real_get_image (GdkDrawable     *drawable,
@@ -1337,20 +1336,20 @@
   GdkRectangle tmp_rect;
 				       
   g_return_if_fail (GDK_IS_PIXBUF (pixbuf));
-  g_return_if_fail (pixbuf->colorspace == GDK_COLORSPACE_RGB);
-  g_return_if_fail (pixbuf->n_channels == 3 || pixbuf->n_channels == 4);
-  g_return_if_fail (pixbuf->bits_per_sample == 8);
+  g_return_if_fail (gdk_pixbuf_get_colorspace (pixbuf) == GDK_COLORSPACE_RGB);
+  g_return_if_fail (gdk_pixbuf_get_n_channels (pixbuf) == 3 || gdk_pixbuf_get_n_channels (pixbuf) == 4);
+  g_return_if_fail (gdk_pixbuf_get_bits_per_sample (pixbuf) == 8);
 
   g_return_if_fail (drawable != NULL);
 
   if (width == -1) 
-    width = pixbuf->width;
+    width = gdk_pixbuf_get_width (pixbuf);
   if (height == -1)
-    height = pixbuf->height;
+    height = gdk_pixbuf_get_height (pixbuf);
 
   g_return_if_fail (width >= 0 && height >= 0);
-  g_return_if_fail (src_x >= 0 && src_x + width <= pixbuf->width);
-  g_return_if_fail (src_y >= 0 && src_y + height <= pixbuf->height);
+  g_return_if_fail (src_x >= 0 && src_x + width <= gdk_pixbuf_get_width (pixbuf));
+  g_return_if_fail (src_y >= 0 && src_y + height <= gdk_pixbuf_get_height (pixbuf));
 
   /* Clip to the drawable; this is required for get_from_drawable() so
    * can't be done implicitly
@@ -1408,7 +1407,7 @@
   if (!gc)
     gc = _gdk_drawable_get_scratch_gc (drawable, FALSE);
   
-  if (pixbuf->has_alpha)
+  if (gdk_pixbuf_get_has_alpha (pixbuf))
     {
       GdkVisual *visual = gdk_drawable_get_visual (drawable);
       void (*composite_func) (guchar       *src_buf,
@@ -1462,8 +1461,8 @@
 					      dest_x + x0, dest_y + y0,
 					      xs0, ys0,
 					      width1, height1);
-		  (*composite_func) (pixbuf->pixels + (src_y + y0) * pixbuf->rowstride + (src_x + x0) * 4,
-				     pixbuf->rowstride,
+		  (*composite_func) (gdk_pixbuf_get_pixels (pixbuf) + (src_y + y0) * gdk_pixbuf_get_rowstride (pixbuf) + (src_x + x0) * 4,
+				     gdk_pixbuf_get_rowstride (pixbuf),
 				     (guchar*)image->mem + ys0 * image->bpl + xs0 * image->bpp,
 				     image->bpl,
 				     visual->byte_order,
@@ -1490,10 +1489,10 @@
 						     width, height);
 	  
 	  if (composited)
-	    composite (pixbuf->pixels + src_y * pixbuf->rowstride + src_x * 4,
-		       pixbuf->rowstride,
-		       composited->pixels,
-		       composited->rowstride,
+	    composite (gdk_pixbuf_get_pixels (pixbuf) + src_y * gdk_pixbuf_get_rowstride (pixbuf) + src_x * 4,
+		       gdk_pixbuf_get_rowstride (pixbuf),
+		       gdk_pixbuf_get_pixels (composited),
+		       gdk_pixbuf_get_rowstride (composited),
 		       width, height);
 	}
     }
@@ -1505,26 +1504,26 @@
       pixbuf = composited;
     }
   
-  if (pixbuf->n_channels == 4)
+  if (gdk_pixbuf_get_n_channels (pixbuf) == 4)
     {
-      guchar *buf = pixbuf->pixels + src_y * pixbuf->rowstride + src_x * 4;
+      guchar *buf = gdk_pixbuf_get_pixels (pixbuf) + src_y * gdk_pixbuf_get_rowstride (pixbuf) + src_x * 4;
 
       gdk_draw_rgb_32_image_dithalign (drawable, gc,
 				       dest_x, dest_y,
 				       width, height,
 				       dither,
-				       buf, pixbuf->rowstride,
+				       buf, gdk_pixbuf_get_rowstride (pixbuf),
 				       x_dither, y_dither);
     }
   else				/* n_channels == 3 */
     {
-      guchar *buf = pixbuf->pixels + src_y * pixbuf->rowstride + src_x * 3;
+      guchar *buf = gdk_pixbuf_get_pixels (pixbuf) + src_y * gdk_pixbuf_get_rowstride (pixbuf) + src_x * 3;
 
       gdk_draw_rgb_image_dithalign (drawable, gc,
 				    dest_x, dest_y,
 				    width, height,
 				    dither,
-				    buf, pixbuf->rowstride,
+				    buf, gdk_pixbuf_get_rowstride (pixbuf),
 				    x_dither, y_dither);
     }
 
--- gtk+-2.4.14.orig/gdk/gdkpixbuf-drawable.c
+++ gtk+-2.4.14/gdk/gdkpixbuf-drawable.c
@@ -31,7 +31,6 @@
 #include "gdkwindow.h"
 #include "gdkpixbuf.h"
 #include "gdkpixmap.h"
-#include "gdk-pixbuf-private.h"
 #include "gdkinternals.h"
 
 /* Some convenient names
@@ -1231,9 +1230,9 @@
     g_return_val_if_fail (dest_x == 0 && dest_y == 0, NULL);
   else
     {
-      g_return_val_if_fail (dest->colorspace == GDK_COLORSPACE_RGB, NULL);
-      g_return_val_if_fail (dest->n_channels == 3 || dest->n_channels == 4, NULL);
-      g_return_val_if_fail (dest->bits_per_sample == 8, NULL);
+      g_return_val_if_fail (gdk_pixbuf_get_colorspace (dest) == GDK_COLORSPACE_RGB, NULL);
+      g_return_val_if_fail (gdk_pixbuf_get_n_channels (dest) == 3 || gdk_pixbuf_get_n_channels (dest) == 4, NULL);
+      g_return_val_if_fail (gdk_pixbuf_get_bits_per_sample (dest) == 8, NULL);
     }
 
   if (cmap == NULL)
@@ -1282,8 +1281,8 @@
   if (dest)
     {
       g_return_val_if_fail (dest_x >= 0 && dest_y >= 0, NULL);
-      g_return_val_if_fail (dest_x + width <= dest->width, NULL);
-      g_return_val_if_fail (dest_y + height <= dest->height, NULL);
+      g_return_val_if_fail (dest_x + width <= gdk_pixbuf_get_width (dest), NULL);
+      g_return_val_if_fail (dest_y + height <= gdk_pixbuf_get_height (dest), NULL);
     }
 
   for (y0 = 0; y0 < height; y0 += GDK_SCRATCH_IMAGE_HEIGHT)
@@ -1349,9 +1348,9 @@
     g_return_val_if_fail (dest_x == 0 && dest_y == 0, NULL);
   else
     {
-      g_return_val_if_fail (dest->colorspace == GDK_COLORSPACE_RGB, NULL);
-      g_return_val_if_fail (dest->n_channels == 3 || dest->n_channels == 4, NULL);
-      g_return_val_if_fail (dest->bits_per_sample == 8, NULL);
+      g_return_val_if_fail (gdk_pixbuf_get_colorspace (dest) == GDK_COLORSPACE_RGB, NULL);
+      g_return_val_if_fail (gdk_pixbuf_get_n_channels (dest) == 3 || gdk_pixbuf_get_n_channels (dest) == 4, NULL);
+      g_return_val_if_fail (gdk_pixbuf_get_bits_per_sample (dest) == 8, NULL);
     }
 
   if (cmap == NULL)
@@ -1381,8 +1380,8 @@
   if (dest)
     {
       g_return_val_if_fail (dest_x >= 0 && dest_y >= 0, NULL);
-      g_return_val_if_fail (dest_x + width <= dest->width, NULL);
-      g_return_val_if_fail (dest_y + height <= dest->height, NULL);
+      g_return_val_if_fail (dest_x + width <= gdk_pixbuf_get_width (dest), NULL);
+      g_return_val_if_fail (dest_y + height <= gdk_pixbuf_get_height (dest), NULL);
     }
 
   /* Create the pixbuf if needed */
@@ -1393,14 +1392,14 @@
         return NULL;
     }
 
-  alpha = dest->has_alpha;
-  rowstride = dest->rowstride;
+  alpha = gdk_pixbuf_get_has_alpha (dest);
+  rowstride = gdk_pixbuf_get_rowstride (dest);
   bpp = alpha ? 4 : 3;
 
   /* we offset into the image data based on the position we are
    * retrieving from
    */
-  rgbconvert (src, dest->pixels +
+  rgbconvert (src, gdk_pixbuf_get_pixels (dest) +
 	      (dest_y * rowstride) + (dest_x * bpp),
 	      rowstride,
 	      alpha,
--- gtk+-2.4.14.orig/gdk/gdkpixbuf-render.c
+++ gtk+-2.4.14/gdk/gdkpixbuf-render.c
@@ -22,7 +22,6 @@
 
 #include <config.h>
 #include <gdk/gdk.h>
-#include "gdk-pixbuf-private.h"
 #include "gdkpixbuf.h"
 #include "gdkscreen.h"
 #include "gdkinternals.h"
@@ -63,19 +62,19 @@
   int status;
 
   g_return_if_fail (GDK_IS_PIXBUF (pixbuf));
-  g_return_if_fail (pixbuf->colorspace == GDK_COLORSPACE_RGB);
-  g_return_if_fail (pixbuf->n_channels == 3 || pixbuf->n_channels == 4);
-  g_return_if_fail (pixbuf->bits_per_sample == 8);
+  g_return_if_fail (gdk_pixbuf_get_colorspace (pixbuf) == GDK_COLORSPACE_RGB);
+  g_return_if_fail (gdk_pixbuf_get_n_channels (pixbuf) == 3 || gdk_pixbuf_get_n_channels (pixbuf) == 4);
+  g_return_if_fail (gdk_pixbuf_get_bits_per_sample (pixbuf) == 8);
 
   if (width == -1) 
-    width = pixbuf->width;
+    width = gdk_pixbuf_get_width (pixbuf);
   if (height == -1)
-    height = pixbuf->height;
+    height = gdk_pixbuf_get_height (pixbuf);
 
   g_return_if_fail (bitmap != NULL);
   g_return_if_fail (width >= 0 && height >= 0);
-  g_return_if_fail (src_x >= 0 && src_x + width <= pixbuf->width);
-  g_return_if_fail (src_y >= 0 && src_y + height <= pixbuf->height);
+  g_return_if_fail (src_x >= 0 && src_x + width <= gdk_pixbuf_get_width (pixbuf));
+  g_return_if_fail (src_y >= 0 && src_y + height <= gdk_pixbuf_get_height (pixbuf));
 
   g_return_if_fail (alpha_threshold >= 0 && alpha_threshold <= 255);
 
@@ -84,7 +83,7 @@
 
   gc = _gdk_drawable_get_scratch_gc (bitmap, FALSE);
 
-  if (!pixbuf->has_alpha)
+  if (!gdk_pixbuf_get_has_alpha (pixbuf))
     {
       color.pixel = (alpha_threshold == 255) ? 0 : 1;
       gdk_gc_set_foreground (gc, &color);
@@ -101,8 +100,8 @@
 
   for (y = 0; y < height; y++)
     {
-      p = (pixbuf->pixels + (y + src_y) * pixbuf->rowstride + src_x * pixbuf->n_channels
-	   + pixbuf->n_channels - 1);
+      p = (gdk_pixbuf_get_pixels (pixbuf) + (y + src_y) * gdk_pixbuf_get_rowstride (pixbuf) + src_x * gdk_pixbuf_get_n_channels (pixbuf)
+	   + gdk_pixbuf_get_n_channels (pixbuf) - 1);
 	    
       start = 0;
       start_status = *p < alpha_threshold;
@@ -122,7 +121,7 @@
 	      start_status = status;
 	    }
 	  
-	  p += pixbuf->n_channels;
+	  p += gdk_pixbuf_get_n_channels (pixbuf);
 	}
       
       if (!start_status)
--- gtk+-2.4.14.orig/gdk/linux-fb/Makefile.am
+++ gtk+-2.4.14/gdk/linux-fb/Makefile.am
@@ -15,7 +15,6 @@
 	-I$(top_srcdir)		\
 	-I$(top_srcdir)/gdk	\
 	-I$(top_builddir)/gdk	\
-	-DG_DISABLE_DEPRECATED	\
 	-DGDK_PIXBUF_DISABLE_DEPRECATED	\
 	$(GDK_DEP_CFLAGS)	\
 	$(GTK_DEBUG_FLAGS)
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkcolor-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkcolor-fb.c
@@ -25,12 +25,11 @@
  */
 
 #include <config.h>
-#include <time.h>
+
 #include <sys/ioctl.h>
 #include <string.h>
-#include <stdlib.h>
 
-#include "gdkcolor.h"
+#include "gdkscreen.h"
 #include "gdkprivate-fb.h"
 
 #define GDK_COLORMAP_PRIVATE_DATA(cmap) ((GdkColormapPrivateFB *) GDK_COLORMAP (cmap)->windowing_data)
@@ -324,7 +323,6 @@
 {
   guint16 red[256], green[256], blue[256];
   struct fb_cmap fbc = {0,256};
-  GdkColormapPrivateFB *private;
   int i;
 
   g_return_if_fail (colormap != NULL);
@@ -333,7 +331,6 @@
   fbc.green = green;
   fbc.blue = blue;
 
-  private = GDK_COLORMAP_PRIVATE_DATA (colormap);
   switch (colormap->visual->type)
     {
     case GDK_VISUAL_GRAYSCALE:
@@ -627,7 +624,6 @@
 			   gboolean     best_match,
 			   gboolean    *success)
 {
-  GdkColormapPrivateFB *private;
   GdkVisual *visual;
   gint i;
   gint nremaining = 0;
@@ -635,8 +631,6 @@
   g_return_val_if_fail (colormap != NULL, FALSE);
   g_return_val_if_fail (colors != NULL, FALSE);
 
-  private = GDK_COLORMAP_PRIVATE_DATA (colormap);
-
   for (i = 0; i < ncolors; i++)
     success[i] = FALSE;
 
@@ -669,14 +663,11 @@
 gdk_color_change (GdkColormap *colormap,
 		  GdkColor    *color)
 {
-  GdkColormapPrivateFB *private;
   struct fb_cmap fbc = {0, 1};
 
   g_return_val_if_fail (colormap != NULL, FALSE);
   g_return_val_if_fail (color != NULL, FALSE);
 
-  private = GDK_COLORMAP_PRIVATE_DATA (colormap);
-
   switch(colormap->visual->type)
     {
     case GDK_VISUAL_GRAYSCALE:
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkcursor-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkcursor-fb.c
@@ -25,14 +25,14 @@
  */
 
 #include <config.h>
-#include "gdkfb.h"
+
 #include "gdkprivate-fb.h"
-#include "gdkcursor.h"
+#include "gdk.h"
 
 #include "x-cursors.xbm"
 
 static struct {
-  const guchar *bits;
+  const gchar *bits;
   int width, height, hotx, hoty;
   GdkCursor *cursor;
 } stock_cursors[] = {
@@ -512,6 +512,9 @@
   last_location.x = x - GDK_CURSOR_FB (the_cursor)->hot_x;
   last_location.y = y - GDK_CURSOR_FB (the_cursor)->hot_y;
 
+  last_location.x = last_location.x < 0 ? 0 : last_location.x;
+  last_location.y = last_location.y < 0 ? 0 : last_location.y;
+
   if (the_cursor)
     gdk_cursor_ref (the_cursor);
   if (last_cursor)
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkdisplay-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkdisplay-fb.c
@@ -25,6 +25,7 @@
  */
 
 #include <config.h>
+
 #include "gdk.h"
 #include "gdkprivate-fb.h"
 
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkdnd-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkdnd-fb.c
@@ -25,10 +25,8 @@
  */
 
 #include <config.h>
-#include "gdk.h"          /* For gdk_flush() */
-#include "gdkdnd.h"
+
 #include "gdkproperty.h"
-#include "gdkinternals.h"
 #include "gdkprivate-fb.h"
 
 typedef struct _GdkDragContextPrivate GdkDragContextPrivate;
@@ -161,12 +159,10 @@
   GList *tmp_list = contexts;
   
   GdkDragContext *context;
-  GdkDragContextPrivate *private;
 
   while (tmp_list)
     {
       context = (GdkDragContext *)tmp_list->data;
-      private = GDK_DRAG_CONTEXT_PRIVATE_DATA (context);
 
       if ((!context->is_source == !is_source) &&
 	  ((source == NULL) || (context->source_window && (context->source_window == source))) &&
@@ -385,7 +381,7 @@
 {
   GdkWindow *window;
 
-  window = gdk_window_lookup ((GdkNativeWindow) xid);
+  window = gdk_window_lookup (GUINT_TO_POINTER (xid));
 
   if (GPOINTER_TO_INT (gdk_drawable_get_data (window, "gdk-dnd-registered")))
     {
@@ -467,9 +463,9 @@
       guint32 recipient;
 
       /* Check if new destination accepts drags, and which protocol */
-      if ((recipient = gdk_drag_get_protocol ((guint32)dest, protocol)))
+      if ((recipient = gdk_drag_get_protocol (GPOINTER_TO_UINT (dest), protocol)))
 	{
-	  *dest_window = gdk_window_lookup ((GdkNativeWindow) recipient);
+	  *dest_window = gdk_window_lookup (GUINT_TO_POINTER (recipient));
 	  gdk_window_ref (*dest_window);
 	}
       else
@@ -622,14 +618,11 @@
 		 GdkDragAction     action,
 		 guint32           time)
 {
-  GdkDragContextPrivate *private;
   GdkDragContext *src_context;
   GdkEvent tmp_event;
 
   g_return_if_fail (context != NULL);
 
-  private = GDK_DRAG_CONTEXT_PRIVATE_DATA (context);
-
   src_context = gdk_drag_context_find (TRUE,
 				       context->source_window,
 				       context->dest_window);
@@ -671,14 +664,11 @@
 		 gboolean          success,
 		 guint32           time)
 {
-  GdkDragContextPrivate *private;
   GdkDragContext *src_context;
   GdkEvent tmp_event;
 	
   g_return_if_fail (context != NULL);
 
-  private = GDK_DRAG_CONTEXT_PRIVATE_DATA (context);
-
   src_context = gdk_drag_context_find (TRUE,
 				       context->source_window,
 				       context->dest_window);
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkdrawable-fb2.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkdrawable-fb2.c
@@ -1,11 +1,11 @@
 #include <config.h>
+
 #include "gdkprivate-fb.h"
+#include "gdkregion-generic.h"
+#include "gdkscreen.h"
 #include "mi.h"
-#include <string.h>
-#include <gdkregion-generic.h>
 
 #include <pango/pangoft2.h>
-#include <freetype/ftglyph.h>
 
 #ifndef g_alloca
 #define g_alloca alloca
@@ -866,8 +866,8 @@
   p = start = utf8;
   while (p < utf8_end)
     {
-      gunichar wc = g_utf8_get_char (p);
-      p = g_utf8_next_char (p);
+      gunichar wc = g_utf8_get_char ((gchar *)p);
+      p = (guchar *)g_utf8_next_char (p);
       shaper = pango_font_find_shaper (private->pango_font, pango_language_from_string ("fr"), wc);
       if (shaper != last_shaper)
 	{
@@ -876,7 +876,7 @@
 	  analysis.font = private->pango_font;
 	  analysis.level = 0;
 	  
-	  pango_shape (start, p - start, &analysis, glyphs);
+	  pango_shape ((gchar *)start, p - start, &analysis, glyphs);
 
 	  gdk_fb_draw_glyphs (drawable, gc, private->pango_font,
 			      x + PANGO_PIXELS (x_offset), y,
@@ -898,7 +898,7 @@
       analysis.font = private->pango_font;
       analysis.level = 0;
       
-      pango_shape (start, p - start, &analysis, glyphs);
+      pango_shape ((gchar *)start, p - start, &analysis, glyphs);
       
       gdk_fb_draw_glyphs (drawable, gc, private->pango_font,
 			  x + PANGO_PIXELS (x_offset), y,
@@ -1274,15 +1274,12 @@
 		   gint         width,
 		   gint         height)
 {
-  GdkImagePrivateFB *image_private;
   GdkPixmapFBData fbd;
 
   g_return_if_fail (drawable != NULL);
   g_return_if_fail (image != NULL);
   g_return_if_fail (gc != NULL);
 
-  image_private = (GdkImagePrivateFB*) image;
-
   g_return_if_fail (image->type == GDK_IMAGE_NORMAL);
 
   /* Fake its existence as a pixmap */
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkevents-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkevents-fb.c
@@ -25,10 +25,9 @@
  */
 
 #include <config.h>
+
 #include "gdk.h"
-#include "gdkprivate-fb.h"
 #include "gdkinternals.h"
-#include "gdkfb.h"
 
 /*********************************************
  * Functions for maintaining the event queue *
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkfb.h
+++ gtk+-2.4.14/gdk/linux-fb/gdkfb.h
@@ -1,7 +1,7 @@
 #ifndef GDKFB_H
 #define GDKFB_H 1
 
-#include "gdk/gdkprivate.h"
+#include "gdktypes.h"
 
 typedef struct _GdkFBDisplay GdkFBDisplay;
 typedef struct _GdkFBWindow GdkFBWindow;
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkfbmanager.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkfbmanager.c
@@ -1,16 +1,11 @@
-#include <config.h>
-#include <glib.h>
+#define _GNU_SOURCE
+
 #include <glib/gprintf.h>
 
-#include <sys/types.h>
 #include <sys/socket.h>
 #include <sys/un.h>
-#include <sys/time.h>
-#include <sys/types.h>
-#include <string.h>
 #include <errno.h>
 #include <unistd.h>
-#include <fcntl.h>
 
 #include "gdkfbmanager.h"
 
@@ -377,6 +372,7 @@
       res = select (data.max_fd+1, 
 		    &read_fds, NULL, &exception_fds, 
 		    NULL);
+      (void) res;
 
       if (FD_ISSET (master_socket, &read_fds)) 
 	handle_new_client ();
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkfbswitch.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkfbswitch.c
@@ -1,8 +1,8 @@
-#include <config.h>
+#define _GNU_SOURCE
+
 #include <glib.h>
 
 #include <stdlib.h>
-#include <sys/types.h>
 #include <sys/socket.h>
 #include <sys/un.h>
 #include <unistd.h>
@@ -69,6 +69,7 @@
   msg.msg_controllen = cmsg->cmsg_len;
 
   res = sendmsg (fd, &msg, 0);
+  (void) res;
 
   init_msg.msg_type = FB_MANAGER_REQUEST_SWITCH_TO_PID;
   init_msg.data = atoi (argv[1]);
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkfont-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkfont-fb.c
@@ -25,20 +25,13 @@
  */
 
 #include <config.h>
-#include <math.h>
+
 #include <stdlib.h>
 #include <string.h>
-#include "gdkfont.h"
+
 #include "gdkprivate-fb.h"
 #include "gdkpango.h"
 
-#include <pango/pango.h>
-
-#include <freetype/freetype.h>
-#if !defined(FREETYPE_MAJOR) || FREETYPE_MAJOR != 2
-#error "We need Freetype 2.0"
-#endif
-
 #ifdef EMULATE_GDKFONT
 static GHashTable *font_name_hash = NULL;
 static GHashTable *fontset_name_hash = NULL;
@@ -255,13 +248,9 @@
 _gdk_font_strlen (GdkFont     *font,
 		  const gchar *str)
 {
-  GdkFontPrivateFB *font_private;
-
   g_return_val_if_fail (font != NULL, -1);
   g_return_val_if_fail (str != NULL, -1);
 
-  font_private = (GdkFontPrivateFB*) font;
-  
   return strlen (str);
 }
 
@@ -338,8 +327,8 @@
   p = start = utf8;
   while (p < utf8_end)
     {
-      gunichar wc = g_utf8_get_char (p);
-      p = g_utf8_next_char (p);
+      gunichar wc = g_utf8_get_char ((gchar *)p);
+      p = (guchar *)g_utf8_next_char (p);
       shaper = pango_font_find_shaper (private->pango_font, pango_language_from_string ("fr"), wc);
       if (shaper != last_shaper)
 	{
@@ -348,7 +337,7 @@
 	  analysis.font = private->pango_font;
 	  analysis.level = 0;
 
-	  pango_shape (start, p - start, &analysis, glyphs);
+	  pango_shape ((gchar *)start, p - start, &analysis, glyphs);
 
 	  for (i = 0; i < glyphs->num_glyphs; i++)
 	    {
@@ -384,7 +373,7 @@
       analysis.font = private->pango_font;
       analysis.level = 0;
       
-      pango_shape (start, p - start, &analysis, glyphs);
+      pango_shape ((gchar *)start, p - start, &analysis, glyphs);
       
       for (i = 0; i < glyphs->num_glyphs; i++)
 	{
@@ -473,13 +462,8 @@
 _gdk_font_strlen (GdkFont     *font,
 		  const gchar *str)
 {
-  GdkFontPrivateFB *font_private;
-  gint length = 0;
-
   g_return_val_if_fail (font != NULL, -1);
   g_return_val_if_fail (str != NULL, -1);
-
-  font_private = (GdkFontPrivateFB*) font;
   
   return strlen (str);
 }
@@ -524,12 +508,8 @@
 gint
 gdk_font_id (const GdkFont *font)
 {
-  const GdkFontPrivateFB *font_private;
-
   g_return_val_if_fail (font != NULL, 0);
 
-  font_private = (const GdkFontPrivateFB*) font;
-
   if (font->type == GDK_FONT_FONT)
     {
       return -1;
@@ -544,15 +524,9 @@
 gdk_font_equal (const GdkFont *fonta,
                 const GdkFont *fontb)
 {
-  const GdkFontPrivateFB *privatea;
-  const GdkFontPrivateFB *privateb;
-
   g_return_val_if_fail (fonta != NULL, FALSE);
   g_return_val_if_fail (fontb != NULL, FALSE);
 
-  privatea = (const GdkFontPrivateFB*) fonta;
-  privateb = (const GdkFontPrivateFB*) fontb;
-
   if(fonta == fontb)
     return TRUE;
 
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkgc-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkgc-fb.c
@@ -1,11 +1,9 @@
 #include <config.h>
+
 #include <string.h>
-#include <stdlib.h>
 
 #include "gdkprivate-fb.h"
-#include "gdkgc.h"
-#include "gdkfb.h"
-#include "gdkregion-generic.h"
+#include "gdkpixmap.h"
 
 typedef enum {
   GDK_GC_DIRTY_CLIP = 1 << 0,
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkgeometry-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkgeometry-fb.c
@@ -1,5 +1,7 @@
 #include <config.h>
+
 #include "gdkprivate-fb.h"
+#include "gdk.h"
 
 void
 gdk_window_scroll (GdkWindow *window,
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkglobals-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkglobals-fb.c
@@ -25,10 +25,9 @@
  */
 
 #include <config.h>
-#include <stdio.h>
 
-#include "gdktypes.h"
-#include "gdkprivate-fb.h"
+#include "gdkfb.h"
+#include "gdkevents.h"
 
 GdkWindow *_gdk_fb_pointer_grab_window, *_gdk_fb_keyboard_grab_window, *_gdk_fb_pointer_grab_confine = NULL;
 gboolean _gdk_fb_pointer_grab_owner_events;
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkim-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkim-fb.c
@@ -24,19 +24,12 @@
  * GTK+ at ftp://ftp.gtk.org/pub/gtk/. 
  */
 
-#include "gdki18n.h"
-#include "gdkinternals.h"
-#include "gdkprivate-fb.h"
-
-#if HAVE_CONFIG_H
-#  include <config.h>
-#  if STDC_HEADERS
-#    include <string.h>
-#  endif
-#endif
+#include <config.h>
 
 #include <locale.h>
 
+#include "gdktypes.h"
+
 /*
  *--------------------------------------------------------------
  * gdk_set_locale
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkimage-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkimage-fb.c
@@ -27,12 +27,8 @@
 #include <config.h>
 
 #include <stdlib.h>
-#include <sys/types.h>
 #include <string.h>
 
-#include "gdk.h"
-#include "gdkimage.h"
-#include "gdkprivate.h"
 #include "gdkprivate-fb.h"
 
 static gpointer parent_class = NULL;
@@ -113,7 +109,6 @@
 			  gint          depth)
 {
   GdkImage *image;
-  GdkImagePrivateFB *private;
 
   g_return_val_if_fail (!visual || GDK_IS_VISUAL (visual), NULL);
   g_return_val_if_fail (visual || depth != -1, NULL);
@@ -122,7 +117,6 @@
     depth = visual->depth;
 
   image = g_object_new (gdk_image_get_type (), NULL);
-  private = GDK_IMAGE_PRIVATE_DATA (image);
 
   image->type = 0;
   image->visual = visual;
@@ -146,10 +140,8 @@
 		     gint h)
 {
   GdkImage *image;
-  GdkImagePrivateFB *private;
   
   image = g_object_new (gdk_image_get_type (), NULL);
-  private = GDK_IMAGE_PRIVATE_DATA (image);
   
   image->type = GDK_IMAGE_NORMAL;
   image->visual = visual;
@@ -181,7 +173,6 @@
 		       gint            width,
 		       gint            height)
 {
-  GdkImagePrivateFB *private;
   GdkPixmapFBData fbd;
   GdkRegion *region = NULL;
   gboolean handle_cursor = FALSE;
@@ -216,8 +207,6 @@
       dest_y = 0;
     }
   
-  private = GDK_IMAGE_PRIVATE_DATA (image);
-  
   /* Fake its existence as a pixmap */
   memset (&fbd, 0, sizeof(fbd));
   ((GTypeInstance *)&fbd)->g_class = g_type_class_peek (_gdk_pixmap_impl_get_type ());
@@ -261,14 +250,10 @@
 		     gint x,
 		     gint y)
 {
-  GdkImagePrivateFB *private;
-
   g_return_val_if_fail (image != NULL, 0);
   g_return_val_if_fail (x >= 0 && x < image->width, 0);
   g_return_val_if_fail (y >= 0 && y < image->height, 0);
 
-  private = GDK_IMAGE_PRIVATE_DATA (image);
-
   switch (image->depth)
     {
     case 8:
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkinput.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkinput.c
@@ -25,11 +25,9 @@
  */
 
 #include <config.h>
-#include <stdlib.h>
 
 #include "gdkprivate-fb.h"
-#include "gdkinput.h"
-#include "gdkprivate.h"
+#include "gdkdisplay.h"
 #include "gdkinputprivate.h"
 
 static GdkDeviceAxis gdk_input_core_axes[] = {
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkinputprivate.h
+++ gtk+-2.4.14/gdk/linux-fb/gdkinputprivate.h
@@ -27,10 +27,7 @@
 #ifndef __GDK_INPUTPRIVATE_H__
 #define __GDK_INPUTPRIVATE_H__
 
-#include "config.h"
-#include "gdkinput.h"
 #include "gdkevents.h"
-#include "gdkfb.h"
 
 typedef struct _GdkAxisInfo    GdkAxisInfo;
 typedef struct _GdkInputVTable GdkInputVTable;
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkkeyboard-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkkeyboard-fb.c
@@ -18,13 +18,13 @@
  */
 
 #include <config.h>
-#include <gdk/gdk.h>
-#include <gdk/gdkinternals.h>
+
+#include "gdkkeys.h"
 #include "gdkkeysyms.h"
 #include "gdkprivate-fb.h"
+
 #include <errno.h>
 #include <stdlib.h>
-#include <unistd.h>
 #include <string.h>
 #include <ctype.h>
 #include <termios.h>
@@ -726,7 +726,7 @@
 
 	      for (j=0;j<G_N_ELEMENTS (xlate_codes);j++)
 		{
-		  if (iscode (xlate_codes[j].str, &buf[i], left))
+		  if (iscode (xlate_codes[j].str, (char *)&buf[i], left))
 		    {
 		      /* Ctrl-Alt Return can't be pressed in the XLATE driver,
 		       * use Shift F1 instead */
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkmain-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkmain-fb.c
@@ -25,29 +25,26 @@
  */
 
 #include <config.h>
-#include <unistd.h>
+
+#ifdef ENABLE_FB_MANAGER
+#define _GNU_SOURCE
+#endif
 #include <fcntl.h>
-#include <sys/types.h>
 #include <sys/mman.h>
 #include <sys/ioctl.h>
-#include <ctype.h>
-#include <stdio.h>
-#include <time.h>
 #include <stdlib.h>
 #include <string.h>
 #include <sys/vt.h>
 #include <sys/kd.h>
 #include <errno.h>
-#include <signal.h>
-
+#ifdef ENABLE_FB_MANAGER
 #include <sys/socket.h>
 #include <sys/un.h>
+#include "gdkfbmanager.h"
+#endif
 
 #include "gdk.h"
-
 #include "gdkprivate-fb.h"
-#include "gdkinternals.h"
-#include "gdkfbmanager.h"
 
 /* Private variable declarations
  */
@@ -383,6 +380,9 @@
 	  modeinfo->accel_flags = 0;
       }
 
+    (void) (csync);
+    (void) (extsync);
+
     g_free (modename);
     return 1;
   }
@@ -662,6 +662,7 @@
   msg.msg_controllen = cmsg->cmsg_len;
 
   res = sendmsg (fd, &msg, 0);
+  (void) res;
 
   display->manager_fd = fd;
   display->manager_blocked = TRUE;
@@ -921,7 +922,7 @@
    * keyboard is left in a bad state. you can still run 'reset' but
    * that gets annoying after running testgtk for the 20th time.
    */
-  g_atexit(_gdk_windowing_exit);
+  atexit(_gdk_windowing_exit);
 
   gdk_initialized = TRUE;
 
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkmouse-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkmouse-fb.c
@@ -18,18 +18,16 @@
  */
 
 #include <config.h>
-#include <gdk/gdk.h>
-#include <gdk/gdkinternals.h>
+
+#include "gdkdisplay.h"
 #include "gdkprivate-fb.h"
 #include "gdkinputprivate.h"
+
 #include <stdlib.h>
-#include <sys/types.h>
 #include <fcntl.h>
 #include <termios.h>
-#include <sys/ioctl.h>
 #include <string.h>
 #include <math.h>
-#include <unistd.h>
 #include <errno.h>
 
 typedef struct _GdkFBMouse GdkFBMouse;
@@ -460,7 +458,7 @@
 
 static gboolean
 write_all (gint   fd,
-	   gchar *buf,
+	   guchar *buf,
 	   gsize  to_write)
 {
   while (to_write > 0)
@@ -658,7 +656,7 @@
     }
 
   while ((i = read (fd, buf, sizeof(buf))) > 0)
-    g_print ("Got %d bytes of junk from %s\n", mouse->file, i);
+    g_print ("Got %s bytes of junk from %d\n", mouse->file, i);
 
   tcgetattr (fd, &tty);
   tty.c_iflag = IGNBRK | IGNPAR;
@@ -670,7 +668,7 @@
   tty.c_cc[VMIN] = 1;
   tcsetattr (fd, TCSAFLUSH, &tty);
 
-  if (!write_all (fd, "*n", 2))
+  if (!write_all (fd, (guchar *)"*n", 2))
     {
       close (fd);
       return FALSE;
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkpango-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkpango-fb.c
@@ -1,7 +1,6 @@
 #include <config.h>
-#include <glib.h>
-#include "gdkprivate-fb.h"
-#include "gdkpango.h"
+
+#include "gdkscreen.h"
 
 #include <pango/pangoft2.h>
 
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkpixmap-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkpixmap-fb.c
@@ -25,14 +25,10 @@
  */
 
 #include <config.h>
-#include <stdlib.h>
-#include <stdio.h>
+
 #include <string.h>
-/* Needed for SEEK_END in SunOS */
-#include <unistd.h>
 
 #include "gdkpixmap.h"
-#include "gdkfb.h"
 #include "gdkprivate-fb.h"
 
 typedef struct
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkprivate-fb.h
+++ gtk+-2.4.14/gdk/linux-fb/gdkprivate-fb.h
@@ -31,15 +31,11 @@
 #ifndef __GDK_PRIVATE_FB_H__
 #define __GDK_PRIVATE_FB_H__
 
-#include <gdk/gdkprivate.h>
-#include <gdk/gdkinternals.h>
-#include <gdk/gdk.h>
+#include "gdkinternals.h"
+#include "gdkcursor.h"
 #include "gdkfb.h"
-#include "gdkregion-generic.h"
+
 #include <linux/fb.h>
-#include <stdio.h>
-#include <ft2build.h>
-#include FT_FREETYPE_H
 
 #define GDK_TYPE_DRAWABLE_IMPL_FBDATA (gdk_drawable_impl_fb_get_type ())
 #define GDK_DRAWABLE_IMPL_FBDATA(win) ((GdkDrawableFBData *)((GdkWindowObject *)(win))->impl)
@@ -230,7 +226,7 @@
   GdkGC parent_instance;
 
   GdkRegion *clip_region;
-  gchar *dash_list;
+  guchar *dash_list;
   GdkGCValuesMask values_mask;
   GdkGCValues values;
   gint dash_offset;
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkproperty-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkproperty-fb.c
@@ -25,12 +25,11 @@
  */
 
 #include <config.h>
+
 #include <string.h>
-#include <time.h>
 
-#include "gdkfb.h"
+#include "gdkselection.h"
 #include "gdkproperty.h"
-#include "gdkprivate.h"
 #include "gdkprivate-fb.h"
 
 GdkAtom
@@ -138,7 +137,7 @@
   if (!fbd->properties)
     return;
 
-  prop = g_hash_table_lookup (fbd->properties, GUINT_TO_POINTER(property));
+  prop = g_hash_table_lookup (fbd->properties, GUINT_TO_POINTER (property));
   if (!prop)
     return;
 
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkrender-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkrender-fb.c
@@ -1,7 +1,8 @@
 #include <config.h>
+
 #include "gdkprivate-fb.h"
+
 #include <string.h>
-#include <signal.h>
 #include <sys/time.h>
 
 /*
@@ -656,7 +657,7 @@
   guint rowstride;
   int n;
   guchar redval, greenval, blueval;
-  guchar *firstline, *ptr_end;
+  guchar *ptr_end;
 
   if (!_gdk_fb_is_active_vt)
     return;
@@ -680,7 +681,7 @@
     
   n = span->width*3;
     
-  firstline = ptr = mem + span->y * rowstride + span->x*3;
+  ptr = mem + span->y * rowstride + span->x*3;
   ptr_end = ptr+n;
   while (ptr < ptr_end)
     {
@@ -952,7 +953,6 @@
 {
   GdkDrawableFBData *private = GDK_DRAWABLE_FBDATA (drawable);
   int x, y;
-  GdkGCFBData *gc_private;
   guchar *dmem = private->mem;
   guint dst_rowstride = private->rowstride;
   guchar *smem = GDK_DRAWABLE_FBDATA (src)->mem;
@@ -966,8 +966,6 @@
   if (!_gdk_fb_is_active_vt)
     return;
 
-  gc_private = GDK_GC_FBDATA (gc);
-
   fg = GDK_GC_FBDATA (gc)->values.foreground;
   fg_r = fg.red >> 8;
   fg_g = fg.green >> 8;
@@ -1069,7 +1067,6 @@
 				 GdkRectangle   *rect,
 				 GdkColor       *color)
 {
-  GdkGCFBData *gc_private;
   GdkDrawableFBData *private;
   guchar *ptr;
   guint rowstride;
@@ -1083,7 +1080,6 @@
     return;
 
   private = GDK_DRAWABLE_FBDATA (drawable);
-  gc_private = GDK_GC_FBDATA (gc);
 
   rowstride = private->rowstride - rect->width*2;
   ptr = (guchar *)private->mem + rect->y * private->rowstride + rect->x*2;
@@ -1119,7 +1115,6 @@
 				 GdkRectangle   *rect,
 				 GdkColor       *color)
 {
-  GdkGCFBData *gc_private;
   GdkDrawableFBData *private;
   guchar *ptr;
   guint rowstride;
@@ -1132,7 +1127,6 @@
     return;
 
   private = GDK_DRAWABLE_FBDATA (drawable);
-  gc_private = GDK_GC_FBDATA (gc);
 
   rowstride = private->rowstride - rect->width*4;
   ptr = (guchar *)private->mem + rect->y * private->rowstride + rect->x*4;
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkscreen-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkscreen-fb.c
@@ -25,6 +25,7 @@
  */
 
 #include <config.h>
+
 #include "gdk.h"
 #include "gdkprivate-fb.h"
 
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkselection-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkselection-fb.c
@@ -25,14 +25,12 @@
  */
 
 #include <config.h>
-#include <string.h>
 
 #include "gdkproperty.h"
 #include "gdkselection.h"
-#include "gdkprivate.h"
+#include "gdkevents.h"
 #include "gdkprivate-fb.h"
 
-
 typedef struct _OwnerInfo OwnerInfo;
 
 struct _OwnerInfo
@@ -146,10 +144,7 @@
     }
   else
     {
-      /* If no owner for the specified selection exists, the X server
-       * generates a SelectionNotify event to the requestor with property None.
-       */
-      gdk_selection_send_notify ((guint32)requestor,
+      gdk_selection_send_notify (GPOINTER_TO_UINT (requestor),
 				 selection,
 				 target,
 				 GDK_NONE,
@@ -217,14 +212,14 @@
   GdkEvent *event;
   GdkWindow *event_window;
   
-  event_window = gdk_fb_other_event_window (gdk_window_lookup ((GdkNativeWindow) requestor), GDK_SELECTION_NOTIFY);
+  event_window = gdk_fb_other_event_window (gdk_window_lookup (GUINT_TO_POINTER (requestor)), GDK_SELECTION_NOTIFY);
   if (event_window)
     {
       event = gdk_event_make (event_window, GDK_SELECTION_NOTIFY, TRUE);
       event->selection.selection = selection;
       event->selection.target = target;
       event->selection.property = property;
-      event->selection.requestor = (GdkNativeWindow) requestor;
+      event->selection.requestor = GUINT_TO_POINTER (requestor);
     }
 }
 
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkspawn-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkspawn-fb.c
@@ -21,10 +21,7 @@
 
 #include <config.h>
 
-#include "gdkspawn.h"
-
-#include <glib.h>
-#include <gdk/gdk.h>
+#include "gdkscreen.h"
 
 gboolean
 gdk_spawn_on_screen (GdkScreen             *screen,
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkvisual-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkvisual-fb.c
@@ -25,9 +25,10 @@
  */
 
 #include <config.h>
-#include "gdkvisual.h"
+
 #include "gdkprivate-fb.h"
-#include "gdkinternals.h"
+#include "gdkscreen.h"
+
 #include <sys/ioctl.h>
 
 static GdkVisual *system_visual = NULL;
--- gtk+-2.4.14.orig/gdk/linux-fb/gdkwindow-fb.c
+++ gtk+-2.4.14/gdk/linux-fb/gdkwindow-fb.c
@@ -25,14 +25,10 @@
  */
 
 #include <config.h>
-#include "gdk.h"
 
-#include "gdkwindow.h"
-#include "gdkinputprivate.h"
+#include "gdk.h"
+#include "gdkregion-generic.h"
 #include "gdkprivate-fb.h"
-#include "gdkinternals.h"
-
-#include <limits.h>
 
 /* Global variables: */
 static GdkWindow *gdk_fb_window_containing_pointer = NULL;
@@ -169,10 +165,8 @@
   GdkWindow *window;
   GdkWindowObject *private;
   GdkWindowObject *parent_private;
-  GdkVisual *visual;
   GdkWindowFBData *impl;
-
-  int x, y, depth;
+  int x, y;
   
   g_return_val_if_fail (attributes != NULL, NULL);
   
@@ -202,11 +196,6 @@
 
   gdk_window_set_events (window, attributes->event_mask);
 
-  if (attributes_mask & GDK_WA_VISUAL)
-    visual = attributes->visual;
-  else
-    visual = gdk_visual_get_system ();
-
   impl = (GdkWindowFBData *)private->impl;
   impl->drawable_data.wrapper = window;
   private->x = x;
@@ -221,8 +210,6 @@
 
   if (attributes->wclass == GDK_INPUT_OUTPUT)
     {
-      depth = visual->depth;
-
       private->input_only = FALSE;
       private->depth = impl->drawable_data.depth;
       
@@ -231,28 +218,9 @@
 	impl->drawable_data.colormap = attributes->colormap;
       else
 	impl->drawable_data.colormap = gdk_colormap_get_system ();
-      
-      switch (impl->drawable_data.window_type)
-	{
-	case GDK_WINDOW_TOPLEVEL:
-	case GDK_WINDOW_CHILD:
-	case GDK_WINDOW_DIALOG:
-	case GDK_WINDOW_TEMP:
-	default:
-	  break;
-	  
-	case GDK_WINDOW_ROOT:
-	  if (_gdk_parent_root)
-	    g_error ("cannot make windows of type GDK_WINDOW_ROOT");
-	  break;
-	case GDK_DRAWABLE_PIXMAP:
-	  g_error ("cannot make windows of type GDK_DRAWABLE_PIXMAP (use gdk_pixmap_new)");
-	  break;
-	}
     }
   else
     {
-      depth = 0;
       private->input_only = TRUE;
       impl->drawable_data.colormap = NULL;
     }
@@ -298,6 +266,12 @@
   gdk_window_invalidate_rect ((GdkWindow *)private->parent, &r, TRUE);
 }
 
+void
+_gdk_windowing_window_destroy_foreign (GdkWindow *window)
+{
+  _gdk_windowing_window_destroy (window, TRUE, TRUE);
+}
+
 static gboolean
 all_parents_shown (GdkWindowObject *private)
 {
@@ -804,7 +778,6 @@
 {
   GdkWindowObject *private;
   GdkWindow *mousewin;
-  GdkWindow *event_win;
   
   g_return_if_fail (window != NULL);
   
@@ -812,14 +785,9 @@
 
   if (!private->destroyed && GDK_WINDOW_IS_MAPPED (private))
     {
-      GdkEvent *event;
       GdkRectangle r;
       gboolean do_hide;
 
-      event_win = gdk_fb_other_event_window (window, GDK_UNMAP);
-      if (event_win)
-	event = gdk_event_make (event_win, GDK_UNMAP, TRUE);
-
       r.x = GDK_DRAWABLE_IMPL_FBDATA (window)->llim_x;
       r.y = GDK_DRAWABLE_IMPL_FBDATA (window)->llim_y;
       r.width = GDK_DRAWABLE_IMPL_FBDATA (window)->lim_x - r.x;
@@ -1028,7 +996,7 @@
 			   gboolean   send_expose_events)
 {
   GdkWindowObject *private;
-  gint dx, dy, dw, dh;
+  gint dx, dy;
   gint i, draw_dir;
   GdkEvent *event;
   GdkWindow *mousewin;
@@ -1067,8 +1035,6 @@
 
       dx = x - private->x;
       dy = y - private->y;
-      dw = width - GDK_DRAWABLE_IMPL_FBDATA (private)->width;
-      dh = height - GDK_DRAWABLE_IMPL_FBDATA (private)->height;
 
       private->x = x;
       private->y = y;
--- gtk+-2.4.14.orig/gdk/linux-fb/mi.h
+++ gtk+-2.4.14/gdk/linux-fb/mi.h
@@ -2,10 +2,7 @@
 #define MI_H 1
 
 #include "mitypes.h"
-#include "mistruct.h"
-#include "mifpoly.h"
-#include "mifillarc.h"
-#include "mipoly.h"
+#include "gdktypes.h"
 
 void miPolyArc(GdkDrawable *pDraw, GdkGC *pGC, int narcs, miArc *parcs);
 void miPolyFillArc(GdkDrawable *pDraw, GdkGC *pGC, int narcs, miArc *parcs);
--- gtk+-2.4.14.orig/gdk/linux-fb/miarc.c
+++ gtk+-2.4.14/gdk/linux-fb/miarc.c
@@ -45,17 +45,15 @@
 /* Author: Keith Packard and Bob Scheifler */
 /* Warning: this code is toxic, do not dally very long here. */
 
-#define _XOPEN_SOURCE_EXTENDED	/* to get prototype for cbrt on some systems */
-#define _XOPEN_SOURCE     	/* to get prototype for hypot on some systems */
-
-#include <config.h>
 #include <string.h>		/* memmove */
-#include <limits.h>
-
+#include <stdlib.h>		/* abs */
 #include <math.h>
 
-#include "mi.h"
+#include "mitypes.h"
+#include "mifillarc.h"
+#include "mifpoly.h"
 #include "gdkprivate-fb.h"
+#include "gdkpixmap.h"
 
 static double miDsin(double a), miDcos(double a), miDasin(double a), miDatan2(double x, double y);
 
@@ -1551,7 +1549,6 @@
 		xc, yc; /* the center point */
     int		count, i;
     SppPointPtr	poly;
-    GdkPoint last;		/* last point on integer boundaries */
 
     /* The spec says that positive angles indicate counterclockwise motion.
      * Given our coordinate system (with 0,0 in the upper left corner), 
@@ -1598,8 +1595,6 @@
 
     poly[cpt].x = (xc + x0);
     poly[cpt].y = (yc + y0);
-    last.x = ROUNDTOINT( poly[cpt + 1].x = (xc + x1) );
-    last.y = ROUNDTOINT( poly[cpt + 1].y = (yc + y1) );
 
     for(i = 2; i < count; i++)
     {
@@ -1787,7 +1782,7 @@
 	int		arcsJoin;
 	int		selfJoin;
 
-	int		iDash = 0, dashRemaining;
+	int		iDash = 0, dashRemaining = 0;
 	int		iDashStart = 0, dashRemainingStart = 0, iphaseStart;
 	int		startAngle, spanAngle, endAngle, backwards = 0;
 	int		prevDashAngle, dashAngle;
--- gtk+-2.4.14.orig/gdk/linux-fb/midash.c
+++ gtk+-2.4.14/gdk/linux-fb/midash.c
@@ -42,8 +42,11 @@
 ******************************************************************/
 /* $TOG: midash.c /main/14 1998/02/09 14:46:34 kaleb $ */
 
-#include <config.h>
-#include "mi.h"
+#include "mitypes.h"
+#include "mistruct.h"
+#include "mifpoly.h"
+
+#include <stdlib.h>		/* abs */
 
 static miDashPtr CheckDashStorage();
 
--- gtk+-2.4.14.orig/gdk/linux-fb/mifillarc.c
+++ gtk+-2.4.14/gdk/linux-fb/mifillarc.c
@@ -25,9 +25,9 @@
 
 /* $TOG: mifillarc.c /main/20 1998/02/09 14:46:52 kaleb $ */
 
-#include <config.h>
 #include <math.h>
-#include "mi.h"
+
+#include "mitypes.h"
 #include "mifillarc.h"
 #include "gdkprivate-fb.h"
 
--- gtk+-2.4.14.orig/gdk/linux-fb/mifillarc.h
+++ gtk+-2.4.14/gdk/linux-fb/mifillarc.h
@@ -26,6 +26,9 @@
 #ifndef MIFILLARC_H
 #define MIFILLARC_H 1
 
+#include "mitypes.h"
+#include "gdktypes.h"
+
 #define FULLCIRCLE (360 * 64)
 
 typedef struct _miFillArc {
@@ -175,34 +178,25 @@
 			       ((slw > 1) || (ine != inxk)))
 
 extern int miFreeArcCache(
-#if NeedFunctionPrototypes
     gpointer /*data*/,
     guint /*id*/
-#endif
 );
 
 extern struct finalSpan *realAllocSpan(
-#if NeedFunctionPrototypes
     void
-#endif
 );
 
 extern void miFillArcSetup(
-#if NeedFunctionPrototypes
     miArc * /*arc*/,
     miFillArcRec * /*info*/
-#endif
 );
 
 extern void miFillArcDSetup(
-#if NeedFunctionPrototypes
     miArc * /*arc*/,
     miFillArcDRec * /*info*/
-#endif
 );
 
 extern void miEllipseAngleToSlope(
-#if NeedFunctionPrototypes
     int /*angle*/,
     int /*width*/,
     int /*height*/,
@@ -210,15 +204,12 @@
     int * /*dyp*/,
     double * /*d_dxp*/,
     double * /*d_dyp*/
-#endif
 );
 
 extern void miFillArcSliceSetup(
-#if NeedFunctionPrototypes
     miArc * /*arc*/,
     miArcSliceRec * /*slice*/,
     GdkGC* /*pGC*/
-#endif
 );
 
 #endif
--- gtk+-2.4.14.orig/gdk/linux-fb/mifpoly.h
+++ gtk+-2.4.14/gdk/linux-fb/mifpoly.h
@@ -45,6 +45,8 @@
 #ifndef MIFPOLY_H
 #define MIFPOLY_H 1
 
+#include "gdktypes.h"
+
 #define EPSILON	0.000001
 #define ISEQUAL(a,b) (fabs((a) - (b)) <= EPSILON)
 #define UNEQUAL(a,b) (fabs((a) - (b)) > EPSILON)
@@ -97,7 +99,6 @@
 /* mifpolycon.c */
 
 extern void miFillSppPoly(
-#if NeedFunctionPrototypes
     GdkDrawable* /*dst*/,
     GdkGC* /*pgc*/,
     int /*count*/,
@@ -106,7 +107,6 @@
     int /*yTrans*/,
     double /*xFtrans*/,
     double /*yFtrans*/
-#endif
 );
 
 #endif /* MIFPOLY_H */
--- gtk+-2.4.14.orig/gdk/linux-fb/mifpolycon.c
+++ gtk+-2.4.14/gdk/linux-fb/mifpolycon.c
@@ -41,10 +41,12 @@
 
 ******************************************************************/
 /* $TOG: mifpolycon.c /main/13 1998/02/09 14:47:05 kaleb $ */
-#include <config.h>
+
 #include <math.h>
-#include "mi.h"
+
+#include "mitypes.h"
 #include "mifpoly.h"
+#include "gdkprivate-fb.h"
 
 static int GetFPolyYBounds();
 
--- gtk+-2.4.14.orig/gdk/linux-fb/miline.h
+++ gtk+-2.4.14/gdk/linux-fb/miline.h
@@ -74,10 +74,8 @@
 
 #if 0
 extern void miSetZeroLineBias(
-#if NeedFunctionPrototypes
     ScreenPtr /* pScreen */,
     unsigned int /* bias */
-#endif
 );
 #endif
 
@@ -154,7 +152,6 @@
 extern int miZeroLineScreenIndex;
 
 extern int miZeroClipLine(
-#if NeedFunctionPrototypes
     int /*xmin*/,
     int /*ymin*/,
     int /*xmax*/,
@@ -171,7 +168,6 @@
     unsigned int /*bias*/,
     int /*oc1*/,
     int /*oc2*/
-#endif
 );
 
 #endif /* MILINE_H */
--- gtk+-2.4.14.orig/gdk/linux-fb/mipoly.c
+++ gtk+-2.4.14/gdk/linux-fb/mipoly.c
@@ -51,16 +51,14 @@
  *  to the appropriate routine to actually scan convert the
  *  polygon.
  */
-#include <config.h>
-#include "mi.h"
+
+#include "mipoly.h"
 
 extern gboolean miFillGeneralPoly(
-#if NeedFunctionPrototypes
     GdkDrawable* /*dst*/,
     GdkGC* /*pgc*/,
     int /*count*/,
     GdkPoint* /*ptsIn*/
-#endif
 );
 
 void
--- gtk+-2.4.14.orig/gdk/linux-fb/mipoly.h
+++ gtk+-2.4.14/gdk/linux-fb/mipoly.h
@@ -27,6 +27,7 @@
 #define MIPOLY_H
 
 #include "miscanfill.h"
+#include "gdktypes.h"
 
 /*
  *     fill.h
@@ -182,49 +183,37 @@
 /* mipolyutil.c */
 
 extern gboolean miInsertEdgeInET(
-#if NeedFunctionPrototypes
     EdgeTable * /*ET*/,
     EdgeTableEntry * /*ETE*/,
     int /*scanline*/,
     ScanLineListBlock ** /*SLLBlock*/,
     int * /*iSLLBlock*/
-#endif
 );
 
 extern gboolean miCreateETandAET(
-#if NeedFunctionPrototypes
     int /*count*/,
     GdkPoint* /*pts*/,
     EdgeTable * /*ET*/,
     EdgeTableEntry * /*AET*/,
     EdgeTableEntry * /*pETEs*/,
     ScanLineListBlock * /*pSLLBlock*/
-#endif
 );
 
 extern void miloadAET(
-#if NeedFunctionPrototypes
     EdgeTableEntry * /*AET*/,
     EdgeTableEntry * /*ETEs*/
-#endif
 );
 
 extern void micomputeWAET(
-#if NeedFunctionPrototypes
     EdgeTableEntry * /*AET*/
-#endif
 );
 
 extern int miInsertionSort(
-#if NeedFunctionPrototypes
     EdgeTableEntry * /*AET*/
-#endif
 );
 
 extern void miFreeStorage(
-#if NeedFunctionPrototypes
     ScanLineListBlock * /*pSLLBlock*/
-#endif
 );
 
 #endif
--- gtk+-2.4.14.orig/gdk/linux-fb/mipolygen.c
+++ gtk+-2.4.14/gdk/linux-fb/mipolygen.c
@@ -41,9 +41,10 @@
 
 ******************************************************************/
 /* $TOG: mipolygen.c /main/9 1998/02/09 14:47:51 kaleb $ */
-#include <config.h>
-#include "mi.h"
+
+#include "mitypes.h"
 #include "mipoly.h"
+#include "gdkprivate-fb.h"
 
 /*
  *
--- gtk+-2.4.14.orig/gdk/linux-fb/mipolyutil.c
+++ gtk+-2.4.14/gdk/linux-fb/mipolyutil.c
@@ -42,10 +42,7 @@
 
 ******************************************************************/
 /* $TOG: mipolyutil.c /main/6 1998/02/09 14:48:12 kaleb $ */
-#include <config.h>
-#include <limits.h>
-#include "mi.h"
-#include "miscanfill.h"
+
 #include "mipoly.h"
 
 /*
--- gtk+-2.4.14.orig/gdk/linux-fb/mispans.c
+++ gtk+-2.4.14/gdk/linux-fb/mispans.c
@@ -44,9 +44,9 @@
 
 /* $TOG: mispans.c /main/7 1998/02/09 14:48:44 kaleb $ */
 
-#include <config.h>
-#include "mi.h"
 #include "mispans.h"
+#include "gdkprivate-fb.h"
+
 #include <string.h>		/* for memmove */
 
 /*
@@ -286,7 +286,7 @@
 } /* QuickSortSpans */
 
 
-static int UniquifySpansX(spans, newPoints, newWidths)
+static int UniquifySpansX(spans, newPoints)
     Spans		    *spans;
     register GdkSpan    *newPoints;
 {
--- gtk+-2.4.14.orig/gdk/linux-fb/mispans.h
+++ gtk+-2.4.14/gdk/linux-fb/mispans.h
@@ -43,6 +43,8 @@
 
 /* $TOG: mispans.h /main/5 1998/02/09 14:48:48 kaleb $ */
 
+#include "gdktypes.h"
+
 typedef struct {
     int         count;		/* number of spans		    */
     GdkSpan* points;		/* pointer to list of start points  */
@@ -57,60 +59,45 @@
 
 /* Initialize SpanGroup.  MUST BE DONE before use. */
 extern void miInitSpanGroup(
-#if NeedFunctionPrototypes
     SpanGroup * /*spanGroup*/
-#endif
 );
 
 /* Add a Spans to a SpanGroup. The spans MUST BE in y-sorted order */
 extern void miAppendSpans(
-#if NeedFunctionPrototypes
     SpanGroup * /*spanGroup*/,
     SpanGroup * /*otherGroup*/,
     Spans * /*spans*/
-#endif
 );
 
 /* Paint a span group, possibly with some overlap */
 extern void miFillSpanGroup(
-#if NeedFunctionPrototypes
     GdkDrawable* /*pDraw*/,
     GdkGC* /*pGC*/,
     SpanGroup * /*spanGroup*/
-#endif
 );
 
 /* Paint a span group, insuring that each pixel is painted at most once */
 extern void miFillUniqueSpanGroup(
-#if NeedFunctionPrototypes
     GdkDrawable* /*pDraw*/,
     GdkGC* /*pGC*/,
     SpanGroup * /*spanGroup*/
-#endif
 );
 
 /* Free up data in a span group.  MUST BE DONE or you'll suffer memory leaks */
 extern void miFreeSpanGroup(
-#if NeedFunctionPrototypes
     SpanGroup * /*spanGroup*/
-#endif
 );
 
 extern void miSubtractSpans(
-#if NeedFunctionPrototypes
     SpanGroup * /*spanGroup*/,
     Spans * /*sub*/
-#endif
 );
 
 extern void miDisposeSpanGroup(
-#if NeedFunctionPrototypes
     SpanGroup * /*spanGroup*/
-#endif
 );
 
 extern int miClipSpans(
-#if NeedFunctionPrototypes
     GdkRegion* /*prgnDst*/,
     GdkPoint* /*ppt*/,
     int * /*pwidth*/,
@@ -118,7 +105,6 @@
     GdkPoint* /*pptNew*/,
     int * /*pwidthNew*/,
     int /*fSorted*/
-#endif
 );
 
 /* Rops which must use span groups */
--- gtk+-2.4.14.orig/gdk/linux-fb/mistruct.h
+++ gtk+-2.4.14/gdk/linux-fb/mistruct.h
@@ -44,7 +44,7 @@
 #ifndef MISTRUCT_H
 #define MISTRUCT_H
 
-#include "mitypes.h"
+#include "gdktypes.h"
 
 /* information about dashes */
 typedef struct _miDash {
--- gtk+-2.4.14.orig/gdk/linux-fb/mitypes.h
+++ gtk+-2.4.14/gdk/linux-fb/mitypes.h
@@ -6,12 +6,7 @@
 #define ALLOCATE_LOCAL(size) alloca((int)(size))
 #define DEALLOCATE_LOCAL(ptr)  /* as nothing */
 
-#include <stdlib.h>
 #include <glib.h>
-#include <gdk/gdk.h>
-#include <gdkfb.h>
-#include <gdkprivate-fb.h>
-#include <gdkregion-generic.h>
 
 typedef struct _miDash *miDashPtr;
 
--- gtk+-2.4.14.orig/gdk/linux-fb/miwideline.c
+++ gtk+-2.4.14/gdk/linux-fb/miwideline.c
@@ -31,18 +31,11 @@
  * bresenham zero-width lines, except walks an X edge
  */
 
-#include <config.h>
-#include <stdio.h>
-#ifdef _XOPEN_SOURCE
 #include <math.h>
-#else
-#define _XOPEN_SOURCE	/* to get prototype for hypot on some systems */
-#include <math.h>
-#undef _XOPEN_SOURCE
-#endif
 
 #include "mi.h"
 #include "miwideline.h"
+#include "gdkprivate-fb.h"
 
 #ifdef ICEILTEMPDECL
 ICEILTEMPDECL
@@ -407,7 +400,7 @@
 
     if (lw == 1 && !spanData) {
 	/* Lines going in the same direction have no join */
-	if (pLeft->dx >= 0 == pRight->dx <= 0)
+	if ((pLeft->dx >= 0) == (pRight->dx <= 0))
 	    return;
 	if (joinStyle != GDK_JOIN_ROUND) {
     	    denom = - pLeft->dx * (double)pRight->dy + pRight->dx * (double)pLeft->dy;
--- gtk+-2.4.14.orig/gdk/linux-fb/miwideline.h
+++ gtk+-2.4.14/gdk/linux-fb/miwideline.h
@@ -171,7 +171,6 @@
 #endif
 
 extern void miFillPolyHelper(
-#if NeedFunctionPrototypes
     GdkDrawable* /*pDrawable*/,
     GdkGC* /*pGC*/,
     GdkColor * /*pixel*/,
@@ -182,18 +181,14 @@
     PolyEdgePtr /*right*/,
     int /*left_count*/,
     int /*right_count*/
-#endif
 );
 extern int miRoundJoinFace(
-#if NeedFunctionPrototypes
     LineFacePtr /*face*/,
     PolyEdgePtr /*edge*/,
     gboolean * /*leftEdge*/
-#endif
 );
 
 extern void miRoundJoinClip(
-#if NeedFunctionPrototypes
     LineFacePtr /*pLeft*/,
     LineFacePtr /*pRight*/,
     PolyEdgePtr /*edge1*/,
@@ -202,20 +197,16 @@
     int * /*y2*/,
     gboolean * /*left1*/,
     gboolean * /*left2*/
-#endif
 );
 
 extern int miRoundCapClip(
-#if NeedFunctionPrototypes
     LineFacePtr /*face*/,
     gboolean /*isInt*/,
     PolyEdgePtr /*edge*/,
     gboolean * /*leftEdge*/
-#endif
 );
 
 extern void miLineProjectingCap(
-#if NeedFunctionPrototypes
     GdkDrawable* /*pDrawable*/,
     GdkGC* /*pGC*/,
     GdkColor * /*pixel*/,
@@ -225,23 +216,18 @@
     double /*xorg*/,
     double /*yorg*/,
     gboolean /*isInt*/
-#endif
 );
 
 extern SpanDataPtr miSetupSpanData(
-#if NeedFunctionPrototypes
     GdkGC* /*pGC*/,
     SpanDataPtr /*spanData*/,
     int /*npt*/
-#endif
 );
 
 extern void miCleanupSpanData(
-#if NeedFunctionPrototypes
     GdkDrawable* /*pDrawable*/,
     GdkGC* /*pGC*/,
     SpanDataPtr /*spanData*/
-#endif
 );
 
 extern int miPolyBuildEdge(double x0, double y0, double k, int dx, int dy,
--- gtk+-2.4.14.orig/gdk/linux-fb/mizerclip.c
+++ gtk+-2.4.14/gdk/linux-fb/mizerclip.c
@@ -42,8 +42,6 @@
 
 ******************************************************************/
 
-#include <config.h>
-#include "mi.h"
 #include "miline.h"
 
 /*
@@ -407,7 +405,7 @@
 {
     int swapped = 0;
     int clipDone = 0;
-    guint32 utmp = 0;
+    unsigned int utmp = 0;
     int clip1, clip2;
     int x1, y1, x2, y2;
     int x1_orig, y1_orig, x2_orig, y2_orig;
--- gtk+-2.4.14.orig/gdk/linux-fb/mizerline.c
+++ gtk+-2.4.14/gdk/linux-fb/mizerline.c
@@ -43,9 +43,11 @@
 ******************************************************************/
 /* $TOG: mizerline.c /main/18 1998/02/09 14:49:45 kaleb $ */
 
-#include <config.h>
 #include "mi.h"
 #include "miline.h"
+#include "gdkprivate-fb.h"
+
+#include <stdlib.h>		/* abs */
 
 /* Draw lineSolid, fillStyle-independent zero width lines.
  *
--- gtk+-2.4.14.orig/gdk/x11/Makefile.am
+++ gtk+-2.4.14/gdk/x11/Makefile.am
@@ -8,7 +8,6 @@
 	-I$(top_srcdir)			\
 	-I$(top_srcdir)/gdk		\
 	-I$(top_builddir)/gdk		\
-	-DG_DISABLE_DEPRECATED		\
 	-DGDK_PIXBUF_DISABLE_DEPRECATED	\
 	-DGDK_DISABLE_DEPRECATED	\
 	$(GTK_DEBUG_FLAGS) 		\
--- gtk+-2.4.14.orig/gdk-2.0.pc.in
+++ gtk+-2.4.14/gdk-2.0.pc.in
@@ -8,5 +8,5 @@
 Description: GIMP Drawing Kit (${target} target)
 Version: @VERSION@
 Requires: gdk-pixbuf-2.0 @GDK_PACKAGES@
-Libs: -L${libdir} -lgdk-${target}-@GTK_API_VERSION@ @GDK_EXTRA_LIBS@
-Cflags: -I${includedir}/gtk-2.0 -I${libdir}/gtk-2.0/include @GDK_EXTRA_CFLAGS@
+Libs: -L${libdir} -lgdk-@GTK_API_VERSION@ @GDK_EXTRA_LIBS@
+Cflags: -I${includedir}/gtk-2.0 @GDK_EXTRA_CFLAGS@
--- gtk+-2.4.14.orig/gdk-pixbuf/Makefile.am
+++ gtk+-2.4.14/gdk-pixbuf/Makefile.am
@@ -259,7 +259,6 @@
 	-DGTK_SYSCONFDIR=\"$(sysconfdir)\"	\
 	-DGTK_VERSION=\"$(GTK_VERSION)\"	\
 	-DGTK_BINARY_VERSION=\"$(GTK_BINARY_VERSION)\"	\
-	-DG_DISABLE_DEPRECATED			\
 	-DGDK_PIXBUF_DISABLE_DEPRECATED		\
 	-DGTK_PREFIX=\"$(prefix)\"		\
 	$(INCLUDED_LOADER_DEFINE) 		\
--- gtk+-2.4.14.orig/gdk-pixbuf/io-png.c
+++ gtk+-2.4.14/gdk-pixbuf/io-png.c
@@ -184,7 +184,7 @@
                              error_msg);
         }
 
-        longjmp (png_save_ptr->jmpbuf, 1);
+        longjmp (png_jmpbuf(png_save_ptr), 1);
 }
 
 static void
@@ -272,7 +272,7 @@
 		return NULL;
 	}
 
-	if (setjmp (png_ptr->jmpbuf)) {
+	if (setjmp (png_jmpbuf(png_ptr))) {
 	    	if (rows)
 		  	g_free (rows);
 
@@ -433,7 +433,7 @@
                 return NULL;
         }
         
-	if (setjmp (lc->png_read_ptr->jmpbuf)) {
+	if (setjmp (png_jmpbuf(lc->png_read_ptr))) {
 		if (lc->png_info_ptr)
 			png_destroy_read_struct(&lc->png_read_ptr, NULL, NULL);
                 g_free(lc);
@@ -505,7 +505,7 @@
         lc->error = error;
         
         /* Invokes our callbacks as needed */
-	if (setjmp (lc->png_read_ptr->jmpbuf)) {
+	if (setjmp (png_jmpbuf(lc->png_read_ptr))) {
                 lc->error = NULL;
 		return FALSE;
 	} else {
@@ -719,7 +719,7 @@
                              error_msg);
         }
 
-        longjmp (png_read_ptr->jmpbuf, 1);
+        longjmp (png_jmpbuf(png_read_ptr), 1);
 }
 
 static void
@@ -880,7 +880,7 @@
 	       success = FALSE;
 	       goto cleanup;
        }
-       if (setjmp (png_ptr->jmpbuf)) {
+       if (setjmp (png_jmpbuf(png_ptr))) {
 	       success = FALSE;
 	       goto cleanup;
        }
--- gtk+-2.4.14.orig/gtk/Makefile.am
+++ gtk+-2.4.14/gtk/Makefile.am
@@ -21,8 +21,6 @@
 	-I$(top_builddir)/gtk				\
 	-I$(top_srcdir) -I../gdk			\
 	-I$(top_srcdir)/gdk				\
-	-I$(top_srcdir)/gdk-pixbuf -I../gdk-pixbuf	\
-	-DG_DISABLE_DEPRECATED				\
 	-DGDK_PIXBUF_DISABLE_DEPRECATED			\
 	-DGDK_DISABLE_DEPRECATED			\
 	-DGTK_DISABLE_DEPRECATED			\
@@ -75,7 +73,7 @@
 # we use the general approach here
 libgtkincludedir = $(includedir)/gtk-2.0/gtk
 libadd =								\
-	$(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la	\
+	$(GDK_PIXBUF_LIBS)						\
 	$(top_builddir)/gdk/$(gdktargetlib)				\
 	$(GTK_DEP_LIBS)
 
@@ -665,13 +663,13 @@
 	  rm -f $(MAINTAINERCLEANFILES); \
 	fi
 
-DEPS = $(gtktargetlib) $(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la $(top_builddir)/gdk/$(gdktargetlib)
+DEPS = $(gtktargetlib) $(GDK_PIXBUF_DEPS) $(top_builddir)/gdk/$(gdktargetlib)
 
 TEST_DEPS = $(DEPS) gtk.immodules
 
 LDADDS =								\
 	$(gtktargetlib)							\
-	$(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la	\
+	$(GDK_PIXBUF_LIBS)						\
 	$(top_builddir)/gdk/$(gdktargetlib)
 
 #
--- gtk+-2.4.14.orig/gtk/gtkiconfactory.c
+++ gtk+-2.4.14/gtk/gtkiconfactory.c
@@ -2810,7 +2810,7 @@
 }
 
 static GSList *
-g_hash_table_get_keys (GHashTable *table)
+hash_table_get_keys (GHashTable *table)
 {
   GSList *list = NULL;
 
@@ -2845,7 +2845,7 @@
       
       GtkIconFactory *factory = GTK_ICON_FACTORY (tmp_list->data);
 
-      these_ids = g_hash_table_get_keys (factory->icons);
+      these_ids = hash_table_get_keys (factory->icons);
       
       ids = g_slist_concat (ids, these_ids);
       
--- gtk+-2.4.14.orig/gtk/gtkrbtree.c
+++ gtk+-2.4.14/gtk/gtkrbtree.c
@@ -21,7 +21,6 @@
 #include "gtkrbtree.h"
 #include "gtkdebug.h"
 
-static void        _gtk_rbnode_validate_allocator (GAllocator *allocator);
 static GtkRBNode * _gtk_rbnode_new                (GtkRBTree  *tree,
 						   gint        height);
 static void        _gtk_rbnode_free               (GtkRBNode  *node);
@@ -42,76 +41,11 @@
 
 
 
-/* node allocation
- */
-struct _GAllocator /* from gmem.c */
-{
-  gchar      *name;
-  guint16     n_preallocs;
-  guint       is_unused : 1;
-  guint       type : 4;
-  GAllocator *last;
-  GMemChunk  *mem_chunk;
-  GtkRBNode  *free_nodes; /* implementation specific */
-};
-
-
-G_LOCK_DEFINE_STATIC (current_allocator);
-static GAllocator *current_allocator = NULL;
-
-
-/* HOLDS: current_allocator_lock */
-static void
-_gtk_rbnode_validate_allocator (GAllocator *allocator)
-{
-  g_return_if_fail (allocator != NULL);
-  g_return_if_fail (allocator->is_unused == TRUE);
-
-  if (allocator->type != G_ALLOCATOR_NODE)
-    {
-      allocator->type = G_ALLOCATOR_NODE;
-      if (allocator->mem_chunk)
-	{
-	  g_mem_chunk_destroy (allocator->mem_chunk);
-	  allocator->mem_chunk = NULL;
-	}
-    }
-
-  if (!allocator->mem_chunk)
-    {
-      allocator->mem_chunk = g_mem_chunk_new (allocator->name,
-					      sizeof (GtkRBNode),
-					      sizeof (GtkRBNode) * allocator->n_preallocs,
-					      G_ALLOC_ONLY);
-      allocator->free_nodes = NULL;
-    }
-
-  allocator->is_unused = FALSE;
-}
-
 static GtkRBNode *
 _gtk_rbnode_new (GtkRBTree *tree,
 		 gint       height)
 {
-  GtkRBNode *node;
-
-  G_LOCK (current_allocator);
-  if (!current_allocator)
-    {
-      GAllocator *allocator = g_allocator_new ("GTK+ default GtkRBNode allocator",
-					       128);
-      _gtk_rbnode_validate_allocator (allocator);
-      allocator->last = NULL;
-      current_allocator = allocator;
-    }
-  if (!current_allocator->free_nodes)
-    node = g_chunk_new (GtkRBNode, current_allocator->mem_chunk);
-  else
-    {
-      node = current_allocator->free_nodes;
-      current_allocator->free_nodes = node->left;
-    }
-  G_UNLOCK (current_allocator);
+  GtkRBNode *node = g_slice_new (GtkRBNode);
 
   node->left = tree->nil;
   node->right = tree->nil;
@@ -127,21 +61,16 @@
 static void
 _gtk_rbnode_free (GtkRBNode *node)
 {
-  G_LOCK (current_allocator);
-  node->left = current_allocator->free_nodes;
-  current_allocator->free_nodes = node;
   if (gtk_debug_flags & GTK_DEBUG_TREE)
     {
-      /* unfortunately node->left has to continue to point to
-       * a node...
-       */
+      node->left = (gpointer) 0xdeadbeef;
       node->right = (gpointer) 0xdeadbeef;
       node->parent = (gpointer) 0xdeadbeef;
       node->offset = 56789;
       node->count = 56789;
       node->flags = 0;
     }
-  G_UNLOCK (current_allocator);
+  g_slice_free (GtkRBNode, node);
 }
 
 static void
@@ -399,33 +328,6 @@
   GTK_RBNODE_SET_COLOR (node, GTK_RBNODE_BLACK);
 }
 
-/* Public functions */
-void
-_gtk_rbnode_push_allocator (GAllocator *allocator)
-{
-  G_LOCK (current_allocator);
-  _gtk_rbnode_validate_allocator ( allocator );
-  allocator->last = current_allocator;
-  current_allocator = allocator;
-  G_UNLOCK (current_allocator);
-}
-
-void
-_gtk_rbnode_pop_allocator (void)
-{
-  G_LOCK (current_allocator);
-  if (current_allocator)
-    {
-      GAllocator *allocator;
-
-      allocator = current_allocator;
-      current_allocator = allocator->last;
-      allocator->last = NULL;
-      allocator->is_unused = TRUE;
-    }
-  G_UNLOCK (current_allocator);
-}
-
 GtkRBTree *
 _gtk_rbtree_new (void)
 {
@@ -435,7 +337,7 @@
   retval->parent_tree = NULL;
   retval->parent_node = NULL;
 
-  retval->nil = g_new0 (GtkRBNode, 1);
+  retval->nil = g_slice_new (GtkRBNode);
   retval->nil->left = NULL;
   retval->nil->right = NULL;
   retval->nil->parent = NULL;
--- gtk+-2.4.14.orig/gtk/gtkrbtree.h
+++ gtk+-2.4.14/gtk/gtkrbtree.h
@@ -110,8 +110,6 @@
 #define GTK_RBNODE_FLAG_SET(node, flag) 	(node?(((node->flags&flag)==flag)?TRUE:FALSE):FALSE)
 
 
-void       _gtk_rbtree_push_allocator   (GAllocator             *allocator);
-void       _gtk_rbtree_pop_allocator    (void);
 GtkRBTree *_gtk_rbtree_new              (void);
 void       _gtk_rbtree_free             (GtkRBTree              *tree);
 void       _gtk_rbtree_remove           (GtkRBTree              *tree);
--- gtk+-2.4.14.orig/gtk/gtkstock.c
+++ gtk+-2.4.14/gtk/gtkstock.c
@@ -169,7 +169,7 @@
 }
 
 static GSList *
-g_hash_table_get_keys (GHashTable *table)
+hash_table_get_keys (GHashTable *table)
 {
   GSList *list = NULL;
 
@@ -198,7 +198,7 @@
   
   init_stock_hash ();
 
-  ids = g_hash_table_get_keys (stock_hash);
+  ids = hash_table_get_keys (stock_hash);
   icon_ids = _gtk_icon_factory_list_ids ();
   ids = g_slist_concat (ids, icon_ids);
 
--- gtk+-2.4.14.orig/gtk/stock-icons/Makefile.am
+++ gtk+-2.4.14/gtk/stock-icons/Makefile.am
@@ -298,15 +298,10 @@
 noinst_DATA = gtkstockpixbufs.h
 CLEANFILES = $(noinst_DATA)
 
-if CROSS_COMPILING
 pixbuf_csource=$(GDK_PIXBUF_CSOURCE)
-pixbuf_csource_deps=
-else
-pixbuf_csource=GDK_PIXBUF_MODULE_FILE=$(top_builddir)/gdk-pixbuf/gdk-pixbuf.loaders $(top_builddir)/gdk-pixbuf/gdk-pixbuf-csource
-pixbuf_csource_deps=$(top_builddir)/gdk-pixbuf/gdk-pixbuf-csource $(top_builddir)/gdk-pixbuf/gdk-pixbuf.loaders 
-endif
+pixbuf_csource_deps=$(GDK_PIXBUF_CSOURCE_DEPS)
 
-gtkstockpixbufs.h: @REBUILD_PNGS@ $(pixbuf_csource_deps) $(IMAGES)
+gtkstockpixbufs.h: $(pixbuf_csource_deps) $(IMAGES)
 	$(pixbuf_csource)						\
 	   --raw --build-list $(VARIABLES1) > gtkstockpixbufs.h ||	\
            ( rm -f gtkstockpixbufs.h && false )
--- gtk+-2.4.14.orig/gtk/theme-bits/Makefile.am
+++ gtk+-2.4.14/gtk/theme-bits/Makefile.am
@@ -1,11 +1,10 @@
 INCLUDES = -I$(top_srcdir) -I$(top_builddir) 	\
-	-DG_DISABLE_DEPRECATED			\
 	-DGDK_PIXBUF_DISABLE_DEPRECATED		\
-	$(GDK_PIXBUF_DEP_CFLAGS)
+	$(GDK_PIXBUF_CFLAGS)
 
 noinst_PROGRAMS = decompose-bits
 
 decompose_bits_SOURCES = decompose-bits.c
-decompose_bits_LDADD = $(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la
+decompose_bits_LDADD = $(GDK_PIXBUF_LIBS)
 
 EXTRA_DIST = check-13.png check-13-inconsistent.png radio-13.png radio-13-inconsistent.png
--- gtk+-2.4.14.orig/gtk+-2.0.pc.in
+++ gtk+-2.4.14/gtk+-2.0.pc.in
@@ -10,6 +10,6 @@
 Name: GTK+
 Description: GIMP Tool Kit (${target} target)
 Version: @VERSION@
-Requires: gdk-${target}-2.0 @GTK_PACKAGES@
-Libs: -L${libdir} -lgtk-${target}-@GTK_API_VERSION@ @GTK_EXTRA_LIBS@
+Requires: gdk-2.0 @GTK_PACKAGES@
+Libs: -L${libdir} -lgtk-@GTK_API_VERSION@ @GTK_EXTRA_LIBS@
 Cflags: -I${includedir}/gtk-2.0 @GTK_EXTRA_CFLAGS@
--- gtk+-2.4.14.orig/gtk-doc.m4
+++ gtk+-2.4.14/gtk-doc.m4
@@ -0,0 +1,53 @@
+dnl -*- mode: autoconf -*-
+
+# serial 1
+
+dnl Usage:
+dnl   GTK_DOC_CHECK([minimum-gtk-doc-version])
+AC_DEFUN([GTK_DOC_CHECK],
+[
+  AC_BEFORE([AC_PROG_LIBTOOL],[$0])dnl setup libtool first
+  AC_BEFORE([AM_PROG_LIBTOOL],[$0])dnl setup libtool first
+  dnl for overriding the documentation installation directory
+  AC_ARG_WITH(html-dir,
+    AC_HELP_STRING([--with-html-dir=PATH], [path to installed docs]),,
+    [with_html_dir='${datadir}/gtk-doc/html'])
+  HTML_DIR="$with_html_dir"
+  AC_SUBST(HTML_DIR)
+
+  dnl enable/disable documentation building
+  AC_ARG_ENABLE(gtk-doc,
+    AC_HELP_STRING([--enable-gtk-doc],
+                   [use gtk-doc to build documentation [default=no]]),,
+    enable_gtk_doc=no)
+
+  have_gtk_doc=no
+  if test x$enable_gtk_doc = xyes; then
+    if test -z "$PKG_CONFIG"; then
+      AC_PATH_PROG(PKG_CONFIG, pkg-config, no)
+    fi
+    if test "$PKG_CONFIG" != "no" && $PKG_CONFIG --exists gtk-doc; then
+      have_gtk_doc=yes
+    fi
+
+  dnl do we want to do a version check?
+ifelse([$1],[],,
+    [gtk_doc_min_version=$1
+    if test "$have_gtk_doc" = yes; then
+      AC_MSG_CHECKING([gtk-doc version >= $gtk_doc_min_version])
+      if $PKG_CONFIG --atleast-version $gtk_doc_min_version gtk-doc; then
+        AC_MSG_RESULT(yes)
+      else
+        AC_MSG_RESULT(no)
+        have_gtk_doc=no
+      fi
+    fi
+])
+    if test "$have_gtk_doc" != yes; then
+      enable_gtk_doc=no
+    fi
+  fi
+
+  AM_CONDITIONAL(ENABLE_GTK_DOC, test x$enable_gtk_doc = xyes)
+  AM_CONDITIONAL(GTK_DOC_USE_LIBTOOL, test -n "$LIBTOOL")
+])
--- gtk+-2.4.14.orig/modules/input/Makefile.am
+++ gtk+-2.4.14/modules/input/Makefile.am
@@ -8,7 +8,6 @@
 	-I$(top_srcdir) 				\
 	-I$(top_srcdir)/gdk				\
 	-I$(top_builddir)/gdk				\
-	-DG_DISABLE_DEPRECATED	 			\
 	-DGDK_PIXBUF_DISABLE_DEPRECATED			\
 	-DGDK_DISABLE_DEPRECATED			\
 	-DGTK_DISABLE_DEPRECATED 			\
@@ -16,13 +15,7 @@
 	$(GTK_XIM_FLAGS)				\
 	$(GTK_DEP_CFLAGS)
 
-DEPS = \
-	$(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la	\
-	$(top_builddir)/gdk/$(gdktargetlib) 				\
-	$(top_builddir)/gtk/$(gtktargetlib)
-
 LDADDS = \
-	$(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la	\
 	$(top_builddir)/gdk/$(gdktargetlib)        			\
 	$(top_builddir)/gtk/$(gtktargetlib) 				\
 	$(GTK_DEP_LIBS)
--- gtk+-2.4.14.orig/tests/Makefile.am
+++ gtk+-2.4.14/tests/Makefile.am
@@ -4,7 +4,6 @@
 	-I$(top_srcdir)				\
 	-I$(top_builddir)/gdk			\
 	-I$(top_srcdir)/gdk			\
-	-DG_DISABLE_DEPRECATED			\
 	-DGDK_PIXBUF_DISABLE_DEPRECATED		\
 	-DGDK_DISABLE_DEPRECATED		\
 	-DGTK_DISABLE_DEPRECATED		\
@@ -12,12 +11,12 @@
 	$(GTK_DEP_CFLAGS)
 
 DEPS =									\
-	$(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la	\
+	$(GDK_PIXBUF_DEPS)						\
 	$(top_builddir)/gdk/$(gdktargetlib)				\
 	$(top_builddir)/gtk/$(gtktargetlib)
 
 LDADDS =								\
-	$(top_builddir)/gdk-pixbuf/libgdk_pixbuf-$(GTK_API_VERSION).la	\
+	$(GDK_PIXBUF_LIBS)						\
 	$(top_builddir)/gdk/$(gdktargetlib)				\
 	$(top_builddir)/gtk/$(gtktargetlib)
 
@@ -101,7 +100,7 @@
 testdnd_LDADD = $(LDADDS)
 testentrycompletion_LDADD = $(LDADDS)
 testfilechooser_LDADD = $(LDADDS)
-testgtk_LDADD = $(LDADDS)
+testgtk_LDADD = $(LDADDS) $(MATH_LIB)
 testicontheme_LDADD = $(LDADDS)
 testinput_LDADD = $(LDADDS)
 testmenus_LDADD = $(LDADDS)

# source
https://download.gnome.org/sources/gtk+/2.4/gtk+-2.4.14.tar.gz

# This file is part of HiGFXback

# requires
REQUIRES="autotools-wrappers-ac-build ncurses-build"

if ! pkg-config --exists --print-errors $REQUIRES; then exit 1; fi

# configure (ac-2.69)
cd src; autoconf -o auto/configure; cd -
./configure --prefix=

# build
make

# install
install -d $DESTDIR/bin
install src/vim $DESTDIR/bin
ln -sf vim $DESTDIR/bin/ex
ln -sf vim $DESTDIR/bin/rview
ln -sf vim $DESTDIR/bin/rvim
ln -sf vim $DESTDIR/bin/vi
ln -sf vim $DESTDIR/bin/view
ln -sf vim $DESTDIR/bin/vimdiff
install src/xxd/xxd $DESTDIR/bin
install -d $DESTDIR/share/vim/vim82
install -m 644 runtime/filetype.vim $DESTDIR/share/vim/vim82
install -m 644 runtime/rgb.txt $DESTDIR/share/vim/vim82
install -m 644 runtime/scripts.vim $DESTDIR/share/vim/vim82
install -d $DESTDIR/share/vim/vim82/autoload/dist
install -m 644 runtime/autoload/dist/ft.vim $DESTDIR/share/vim/vim82/autoload/dist
install -d $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/automake.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/c.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/config.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/cpp.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/diff.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/dtd.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/make.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/m4.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/meson.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/perl.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/pod.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/python.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/sh.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/strace.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/syncolor.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/synload.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/syntax.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/vim.vim $DESTDIR/share/vim/vim82/syntax
install -m 644 runtime/syntax/xml.vim $DESTDIR/share/vim/vim82/syntax

# build.pc
install -d $DESTDIR/share/pkgconfig
cat > $DESTDIR/share/pkgconfig/vim-build.pc << EOF
Name: vim
Version: 8.2
Description: Vi IMproved
Requires: $REQUIRES

exec=\\
/bin/ex \\
/bin/rview \\
/bin/rvim \\
/bin/vi \\
/bin/view \\
/bin/vim \\
/bin/vimdiff \\
/bin/xxd \\
/share/vim/vim82/filetype.vim \\
/share/vim/vim82/rgb.txt \\
/share/vim/vim82/scripts.vim \\
/share/vim/vim82/autoload/dist/ft.vim \\
/share/vim/vim82/syntax/automake.vim \\
/share/vim/vim82/syntax/c.vim \\
/share/vim/vim82/syntax/config.vim \\
/share/vim/vim82/syntax/cpp.vim \\
/share/vim/vim82/syntax/diff.vim \\
/share/vim/vim82/syntax/dtd.vim \\
/share/vim/vim82/syntax/m4.vim \\
/share/vim/vim82/syntax/make.vim \\
/share/vim/vim82/syntax/meson.vim \\
/share/vim/vim82/syntax/perl.vim \\
/share/vim/vim82/syntax/pod.vim \\
/share/vim/vim82/syntax/python.vim \\
/share/vim/vim82/syntax/sh.vim \\
/share/vim/vim82/syntax/strace.vim \\
/share/vim/vim82/syntax/syncolor.vim \\
/share/vim/vim82/syntax/synload.vim \\
/share/vim/vim82/syntax/syntax.vim \\
/share/vim/vim82/syntax/vim.vim \\
/share/vim/vim82/syntax/xml.vim
EOF

exit
--- vim-8.2.orig/src/configure
+++ vim-8.2/src/configure
@@ -1,5 +1,6 @@
 #! /bin/sh
-# run the automatically generated configure script
+# Run the automatically generated configure script
+# Generated by GNU Autoconf 2.69.
 CONFIG_STATUS=auto/config.status \
 	auto/configure "$@" --srcdir="${srcdir:-.}" --cache-file=auto/config.cache
 result=$?
